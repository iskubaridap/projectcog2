define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Dialog=require("./Dialog");var OnlineResult=require("../panels/OnlineResult");var linkify=require("../helpers/linkify");var ComponentDialog=function(_Dialog){_inherits(ComponentDialog,_Dialog);function ComponentDialog(elem){_classCallCheck(this,ComponentDialog);_get(Object.getPrototypeOf(ComponentDialog.prototype),"constructor",this).call(this,elem);this.nameElem=elem.find(".component-name");this.descriptionElem=elem.find(".description");this.authorElem=elem.find(".author");this.previewElem=elem.find(".preview");this.voteElem=elem.find(".vote");this.statsElem=elem.find(".stats");this.installButton=elem.find(".btn");this.authorNameElem=elem.find(".author .name");this.authorDownloadsElem=elem.find(".author .downloads");this.textArea=elem.find("textarea");this.submitButton=elem.find(".button.submit");this.formErrorElement=elem.find(".comment-form .error-message");this.currentUserPhoto=elem.find(".comment-form .photo");this.submitButton.on("click",this.saveComment.bind(this));this.textArea.on("input",this.textAreaInput.bind(this));this.commentList=elem.find(".comment-list");this.domToComment=new WeakMap;this.commentToDOM=new WeakMap;this.commentList.on("click",".comment-text a",this.clickCommentLink.bind(this));this.commentList.on("click",".menu",this.clickCommentMenu.bind(this));this.commentList.on("click",".save.button",this.saveEditForm.bind(this));this.commentList.on("click",".cancel.button",this.clickCancelEditing.bind(this));this.commentList.on("input","textarea",this.saveTextareaInput.bind(this));this.commentList.on("click",".comment-author-name, .comment-author-photo",this.clickCommentAuthor.bind(this));this.authorElem.on("click",".name",this.clickComponentAuthor.bind(this));this.resetScrollTop=false;elem.find(".button.cancel").on("click",this.close.bind(this))}_createClass(ComponentDialog,[{key:"clickCommentLink",value:function clickCommentLink(e){e.preventDefault();electron.openBrowserWindow(e.target.href)}},{key:"clickComponentAuthor",value:function clickComponentAuthor(e){app.profileDialog.open({profileID:$(e.target).data("authorID")})}},{key:"clickCommentAuthor",value:function clickCommentAuthor(e){var commentElem=$(e.target).closest(".comment");var comment=this.domToComment.get(commentElem[0]);app.profileDialog.open({profileID:comment.author_id})}},{key:"textAreaInput",value:function textAreaInput(e){this.submitButton.toggleClass("disable",this.textArea.val().trim().length==0)}},{key:"saveComment",value:function saveComment(e){var comment=this.textArea.val().trim();if(!comment.length)return;var that=this;this.formErrorElement.text("");this.submitButton.addClass("disable");$.post("/app/library/save-comment",{id:that.componentID,comment:comment}).done(function(){that.resetForm();that.update()}).fail(function(){that.submitButton.addClass("disable");that.formErrorElement.text("Your comment couldn't be saved. Please try again.")})}},{key:"saveTextareaInput",value:function saveTextareaInput(e){var commentElem=$(e.target).closest(".comment");commentElem.find(".save").toggleClass("disable",!e.target.value.trim().length)}},{key:"saveEditForm",value:function saveEditForm(e){var commentElem=$(e.target).closest(".comment");var comment=this.domToComment.get(commentElem[0]);commentElem.find(".save").addClass("disable");var that=this;$.post("/app/library/update-comment",{id:comment.id,comment:commentElem.find("textarea").val()}).always(function(){that.update()})}},{key:"clickCommentMenu",value:function clickCommentMenu(e){var menu=$(e.target).closest(".menu");var top=menu.offset().top;var left=menu.offset().left+menu.width();var comment=this.domToComment.get($(e.target).closest(".comment")[0]);var options=[];var that=this;if(comment.can_edit){options.push({name:"Edit",action:function action(){that.editComment(comment)}})}if(comment.can_delete){options.push({name:"Delete",action:function action(){that.deleteComment(comment)}})}if(!options.length){return}app.contextMenu.show(left,top,options,{gravity:"left"})}},{key:"editComment",value:function editComment(comment){var commentElem=$(this.commentToDOM.get(comment));commentElem.addClass("editing");commentElem.find("textarea").val(comment.comment);commentElem.find(".button.save").removeClass("disable")}},{key:"clickCancelEditing",value:function clickCancelEditing(e){var commentElem=$(e.target).closest(".comment");commentElem.removeClass("editing")}},{key:"deleteComment",value:function deleteComment(comment){app.confirmDialog.open({title:"Delete Comment",message:"Are you sure you want to delete this comment? This can't be undone.",okButton:"Delete",onOK:function onOK(dialog){dialog.disableButtons();$.post("/app/library/delete-comment",{id:comment.id}).always(function(){dialog.enableButtons();dialog.close()});return false}})}},{key:"open",value:function open(options){this.componentID=options.componentID;this.element.addClass("loading");this.resetForm();this.resetScrollTop=true;_get(Object.getPrototypeOf(ComponentDialog.prototype),"open",this).call(this,options)}},{key:"resetForm",value:function resetForm(){this.textArea.val("");this.submitButton.addClass("disable");this.formErrorElement.text("")}},{key:"update",value:function update(){this.element.removeClass("error");var that=this;$.get("/app/library/component",{id:this.componentID}).done(function(response){var component=response.component;var vote=response.vote;that.nameElem.text(component.name);that.descriptionElem.text(component.description);that.authorNameElem.text(component.author_name);that.authorNameElem.data("authorID",component.author_id);if(component.author_downloads==0){that.authorDownloadsElem.hide()}else{that.authorDownloadsElem.text(component.author_downloads)}if(component.preview){that.previewElem.show().css("background-image","url("+component.preview+")").text("")}else{that.previewElem.hide()}that.statsElem.find(".installation-count").text(component.downloads+" Install"+(component.downloads==1?"":"s"));that.statsElem.find(".publish-date").text(component.published_on);that.statsElem.find(".framework-version").text("Bootstrap "+component.bootstrap_version);that.installButton.removeClass("install uninstall inactive");that.installButton.off("click");if(app.downloadedPackages.hasID(component.component_id)){that.installButton.addClass("uninstall").text("Uninstall");that.installButton.one("click",function(){var comp=app.downloadedPackages.getByID(component.component_id);app.getPanel("studio").uninstallComponent(comp);that.update()})}else if(app.userPackages.hasID(component.component_id)){that.installButton.addClass("inactive").text("Installed")}else{that.installButton.addClass("install").text("Install");that.installButton.one("click",function(){app.getPanel("studio").installOnlineComponent(new OnlineResult(component),function(){that.update()})})}that.voteElem.removeClass("readonly voted_up voted_down");that.voteElem.find(".count").text(component.votes);if(vote.can_vote){if(vote.has_voted){that.voteElem.addClass(vote.has_voted>0?"voted_up":"voted_down")}that.voteElem.find(".arrow").off("click").one("click",function(e){var isUp=$(e.target).is(".up");var isDown=!isUp;if(vote.has_voted&&(isUp&&vote.has_voted>0||isDown&&vote.has_voted<0)){$.post("/app/library/clear-vote",{id:component.component_id}).done(function(){that.update()})}else{$.post("/app/library/vote",{id:component.component_id,vote:isUp?1:-1}).done(function(){that.update()})}})}else{that.voteElem.addClass("readonly")}that.currentUserPhoto.css("background-image","url("+response.profile.photo+")");that.commentList.empty();var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=response.comments[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var comment=_step.value;that.commentList.append(that.buildComment(comment))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}if(that.resetScrollTop){that.element.find(".scroll-container")[0].scrollTop=0;that.resetScrollTop=false}}).fail(function(msg){that.element.addClass("error")}).always(function(){that.element.removeClass("loading")})}},{key:"buildComment",value:function buildComment(comment){var dom=$('<div class="comment">\n\t\t\t<div class="comment-author-photo"></div>\n\t\t\t<div class="comment-content">\n\t\t\t\t<div class="comment-author-name"></div>\n\t\t\t\t<div class="comment-author-downloads"></div>\n\t\t\t\t<div class="comment-date"></div>\n\t\t\t\t<div class="menu"><span></span></div>\n\t\t\t\t<div class="comment-text"></div>\n\t\t\t</div>\n\t\t\t<div class="comment-edit-form">\n\t\t\t\t<textarea placeholder="Write your comment here"></textarea>\n\t\t\t\t<div class="button primary save">Save</div>\n\t\t\t\t<div class="button cancel">Cancel</div>\n\t\t\t</div>\n\t\t</div>');dom.find(".comment-author-photo").css("background-image","url("+comment.author_photo+")");dom.find(".comment-author-name").text(comment.author_name);if(comment.author_downloads==0){dom.find(".comment-author-downloads").hide()}else{dom.find(".comment-author-downloads").text(comment.author_downloads)}dom.find(".comment-date").text(comment.published_on);dom.find(".menu").toggle(comment.can_edit||comment.can_delete);var commentTextElem=dom.find(".comment-text");commentTextElem.text(comment.comment);commentTextElem.html(linkify(commentTextElem.html().replace(/\n{2,}/g,"\n\n").replace(/\n/g,"<br>")));this.domToComment.set(dom[0],comment);this.commentToDOM.set(comment,dom[0]);return dom}}]);return ComponentDialog}(Dialog);module.exports=ComponentDialog},{"../helpers/linkify":587,"../panels/OnlineResult":1228,"./Dialog":498}]
});
define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Dialog=require("./Dialog");var CreateWebsiteDialog=function(_Dialog){_inherits(CreateWebsiteDialog,_Dialog);function CreateWebsiteDialog(elem){_classCallCheck(this,CreateWebsiteDialog);_get(Object.getPrototypeOf(CreateWebsiteDialog.prototype),"constructor",this).call(this,elem);this.listing=elem.find(".listing");this.domainType=elem.find(".domain-type");this.domainType.on("change",this.changeDomainType.bind(this));this.passkeyField=elem.find(".passkey");this.passkeyField.on("input",this.passkeyInput.bind(this));this.passkeyCheckbox=elem.find(".passkey-enable input");this.passkeyCheckbox.on("click",this.passkeyToggle.bind(this));this.passkeyErrorMessage=elem.find(".passkey-error");this.passkey="";this.passkeyEnabled=false;this.passkeyValid=false;this.createButton=elem.find(".button.create");this.createButton.on("click",this.createButtonClick.bind(this));this.type="bss.design";this.domain="";this.subdomain="";this.working=false;this.subdomainValidationStatus="neutral";this.subdomainValidationMessage="";this.domainValidationStatus="neutral";this.domainValidationMessage="";this.isLoading=true;this.subdomainRegex=/^[a-z0-9]+[a-z0-9-]+[a-z0-9]+$/i;this.domainRegex=/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i;this.passkeyRegex=/^[a-z0-9- _]{3,20}$/i;this.togglePassTypeIcon=elem.find(".toggle-pass-type");this.togglePassTypeIcon.on("click",this.togglePassType.bind(this));this.subdomainField=elem.find(".subdomain");this.subdomainField.on("input",this.subdomainFieldInput.bind(this));this.subdomainErrorMessage=elem.find(".subdomain-error");this.domainField=elem.find(".domain");this.domainField.on("input",this.domainFieldInput.bind(this));this.domainErrorMessage=elem.find(".domain-error");this.domainInstructions=elem.find(".domain-instructions");this.domainExplanation=elem.find(".domain-explanation");this.checkDomainButton=elem.find(".button.check");this.checkDomainButton.on("click",this.checkDomainButtonClick.bind(this));this.verifyDomainButton=elem.find(".button.verify");this.verifyDomainButton.on("click",this.verifyDomainButtonClick.bind(this));elem.find(".button.cancel").on("click",this.close.bind(this))}_createClass(CreateWebsiteDialog,[{key:"open",value:function open(options){this.type="bss.design";this.domain="";this.subdomain="";this.working=false;this.subdomainValidationStatus="neutral";this.subdomainValidationMessage="";this.domainValidationStatus="neutral";this.domainValidationMessage="";this.isLoading=true;this.passkey="";this.passkeyEnabled=false;this.passkeyValid=false;this.suggestFreeSubdomain();_get(Object.getPrototypeOf(CreateWebsiteDialog.prototype),"open",this).call(this,options)}},{key:"togglePassType",value:function togglePassType(e){e.preventDefault();if(this.passkeyField.attr("type")=="text"){this.passkeyField.attr("type","password")}else{this.passkeyField.attr("type","text")}}},{key:"passkeyToggle",value:function passkeyToggle(e){this.passkeyEnabled=e.target.checked;this.update()}},{key:"passkeyInput",value:function passkeyInput(e){if(!this.passkeyEnabled){return}this.passkey=e.target.value.trim();this.passkeyValid=true;if(!this.passkeyRegex.test(this.passkey)){this.passkeyValid=false}this.createButton.toggleClass("disable",!this.passkeyValid);this.passkeyErrorMessage.toggle(!this.passkeyValid)}},{key:"changeDomainType",value:function changeDomainType(e){this.type=e.target.value;this.update()}},{key:"checkDomainButtonClick",value:function checkDomainButtonClick(e){if(!this.domainRegex.test(this.domain)||this.domainValidationStatus=="invalid"){return}this.validateDomain()}},{key:"verifyDomainButtonClick",value:function verifyDomainButtonClick(e){var _this=this;if(this.working)return;this.working=true;this.verifyDomainButton.addClass("disable");$.post("/app/websites/verify-domain",{domain:this.domain}).done(function(response){_this.markDomainAvailable();if(response.status=="success"){setTimeout(function(){_this.createDomain()},20)}else{_this.domainErrorMessage.show().text("DNS record is not yet set.")}}).fail(function(){_this.domainErrorMessage.show().text("Couldn't verify website.")}).always(function(){_this.working=false;_this.verifyDomainButton.removeClass("disable")})}},{key:"createButtonClick",value:function createButtonClick(){if(this.type=="bss.design"){this.createSubdomain()}else{this.createDomain()}}},{key:"createSubdomain",value:function createSubdomain(){var _this2=this;if(this.working)return;this.working=true;$.post("/app/websites/create",{subdomain:this.subdomain,expiration:this.element.find(".delete-after").val(),passkey:this.passkey}).done(function(response){_this2.markSubdomainNeutral();if(response.status=="success"){_this2.close()}else if(response.reason=="website-quota-reached"){_this2.markSubdomainInvalid("You have reached your website quota.")}else{_this2.markSubdomainInvalid("This domain is not available.")}}).fail(function(){_this2.markSubdomainInvalid("Couldn't create website.")}).always(function(){_this2.working=false})}},{key:"createDomain",value:function createDomain(){var _this3=this;if(this.working)return;this.working=true;$.post("/app/websites/create",{domain:this.domain,passkey:this.passkey}).done(function(response){_this3.markDomainAvailable();if(response.status=="success"){_this3.close()}else if(response.reason=="website-quota-reached"){_this3.markDomainInvalid("You have reached your website quota.")}else{_this3.markDomainInvalid("This domain is not available.")}}).fail(function(){_this3.markDomainInvalid("Couldn't create website.")}).always(function(){_this3.working=false})}},{key:"subdomainFieldInput",value:function subdomainFieldInput(){this.subdomain=this.subdomainField.val().trim();clearTimeout(this.subdomainValidateTimeOut);this.markSubdomainValid();if(this.subdomain.length<3){this.markSubdomainInvalid("Should be longer than 3 characters.");return}if(!this.subdomainRegex.test(this.subdomain)){this.markSubdomainInvalid("Please only use letters, numbers and dashes.");return}this.subdomainValidateTimeOut=setTimeout(this.validateSubdomain.bind(this),500)}},{key:"domainFieldInput",value:function domainFieldInput(){this.domain=this.domainField.val().trim();this.markDomainNeutral();if(this.domain.length<3){this.markDomainInvalid("Should be longer than 3 characters.");return}if(!this.domainRegex.test(this.domain)){this.markDomainInvalid("Please only use letters, numbers, dashes and dots.");return}}},{key:"validateSubdomain",value:function validateSubdomain(){var _this4=this;if(this.working)return;this.working=true;var subdomain=this.subdomain;$.post("/app/websites/check-free-domain",{subdomain:subdomain}).done(function(response){if(subdomain!=_this4.subdomain){return}if(response.status=="success"){_this4.markSubdomainValid()}else{_this4.markSubdomainInvalid("This domain is not available.")}}).always(function(){_this4.working=false})}},{key:"validateDomain",value:function validateDomain(){var _this5=this;if(this.working)return;this.working=true;var domain=this.domain;$.post("/app/websites/check-free-domain",{domain:domain}).done(function(response){if(response.status=="success"){_this5.markDomainAvailable()}else{_this5.markDomainInvalid("This domain is not available.")}}).always(function(){_this5.working=false})}},{key:"suggestFreeSubdomain",value:function suggestFreeSubdomain(){var _this6=this;if(this.working)return;this.working=true;$.get("/app/websites/suggest-free-domain").done(function(response){if(response.subdomain){_this6.subdomain=response.subdomain;_this6.markSubdomainValid()}}).always(function(){_this6.isLoading=false;_this6.working=false;_this6.update()})}},{key:"markSubdomainInvalid",value:function markSubdomainInvalid(message){this.subdomainValidationStatus="invalid";this.subdomainValidationMessage=message;this.subdomainField.removeClass("is-valid").addClass("is-invalid");this.subdomainErrorMessage.show().text(message);this.createButton.addClass("disable")}},{key:"markSubdomainNeutral",value:function markSubdomainNeutral(){this.subdomainValidationStatus="neutral";this.subdomainValidationMessage="";this.subdomainField.removeClass("is-invalid is-valid");this.subdomainErrorMessage.hide();this.createButton.addClass("disable")}},{key:"markSubdomainValid",value:function markSubdomainValid(){this.subdomainValidationStatus="valid";this.subdomainValidationMessage="";this.subdomainField.removeClass("is-invalid").addClass("is-valid");this.subdomainErrorMessage.hide();this.createButton.removeClass("disable")}},{key:"markDomainInvalid",value:function markDomainInvalid(message){this.domainValidationStatus="invalid";this.domainValidationMessage=message;this.domainField.removeClass("is-valid").addClass("is-invalid");this.domainErrorMessage.show().text(message);this.createButton.addClass("disable");this.domainInstructions.hide();this.domainExplanation.show()}},{key:"markDomainNeutral",value:function markDomainNeutral(){this.domainValidationStatus="neutral";this.domainValidationMessage="";this.domainField.removeClass("is-invalid is-valid");this.domainErrorMessage.hide();this.createButton.addClass("disable");this.domainInstructions.hide();this.domainExplanation.show()}},{key:"markDomainAvailable",value:function markDomainAvailable(){this.markDomainNeutral();this.domainValidationStatus="available";this.domainInstructions.find(".original-domain").text(this.domain);this.domainInstructions.show();this.domainExplanation.hide()}},{key:"markDomainValid",value:function markDomainValid(){this.domainValidationStatus="valid";this.domainValidationMessage="";this.domainField.removeClass("is-invalid").addClass("is-valid");this.domainErrorMessage.hide();this.createButton.removeClass("disable");this.domainInstructions.hide();this.domainExplanation.hide()}},{key:"update",value:function update(){this.element.toggleClass("loading",this.isLoading);this.domainType.val(this.type);this.element.find(".subdomain-choice").toggle(this.type=="bss.design");this.subdomainField.val(this.subdomain);this.subdomainField.toggleClass("is-valid",this.subdomainValidationStatus=="valid");this.subdomainField.toggleClass("is-invalid",this.subdomainValidationStatus=="invalid");this.subdomainErrorMessage.text(this.subdomainValidationMessage).toggle(this.type=="bss.design"&&this.subdomainValidationStatus=="invalid");this.element.find(".domain-choice").toggle(this.type=="custom");this.domainField.val(this.domain);this.domainField.toggleClass("is-valid",this.domainValidationStatus=="valid");this.domainField.toggleClass("is-invalid",this.domainValidationStatus=="invalid");this.domainErrorMessage.text(this.domainValidationMessage).toggle(this.type=="custom"&&this.domainValidationStatus=="invalid");this.domainInstructions.find(".original-domain").text(this.domain);this.domainInstructions.toggle(this.type=="custom"&&this.domainValidationStatus=="available");this.domainExplanation.toggle(this.type=="custom"&&this.domainValidationStatus!="available");var buttonDisabled=this.working;if(this.type=="bss.design"&&this.subdomainValidationStatus!="valid"){buttonDisabled=true}if(this.type=="custom"&&this.domainValidationStatus!="valid"){buttonDisabled=true}this.passkeyErrorMessage.hide();if(this.passkeyEnabled&&!this.passkeyValid){buttonDisabled=true;this.passkeyErrorMessage.show()}this.passkeyCheckbox.prop("checked",this.passkeyEnabled);this.passkeyField.val(this.passkey).toggle(this.passkeyEnabled);this.togglePassTypeIcon.toggle(this.passkeyEnabled);this.createButton.toggleClass("disable",buttonDisabled)}}]);return CreateWebsiteDialog}(Dialog);module.exports=CreateWebsiteDialog},{"./Dialog":498}]
});
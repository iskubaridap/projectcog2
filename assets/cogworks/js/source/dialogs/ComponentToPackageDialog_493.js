define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x3,_x4,_x5){var _again=true;_function:while(_again){var object=_x3,property=_x4,receiver=_x5;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x3=parent;_x4=property;_x5=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Dialog=require("./Dialog");var Resource=require("../resources/Resource");var escapeHTML=require("escape-html");var domTreeToArray=require("../helpers/domTreeToArray");var findInTree=require("../helpers/findInTree");var sanitizeFilenameInput=require("../helpers/sanitizeFilenameInput");var Image=require("../components/base/Image");var CSSResource=require("../resources/CSSResource");var LinkResource=require("../resources/LinkResource");var ImageResourceTreeGroup=require("../tree/ImageResourceTreeGroup");var ComponentToPackageDialog=function(_Dialog){_inherits(ComponentToPackageDialog,_Dialog);function ComponentToPackageDialog(elem){_classCallCheck(this,ComponentToPackageDialog);_get(Object.getPrototypeOf(ComponentToPackageDialog.prototype),"constructor",this).call(this,elem);this.nameInput=elem.find("#package-name-input");this.okButton=elem.find(".button.ok");this.okButton.on("click",this.onOK.bind(this));this.usedCSS=[];this.usedFonts=[];this.usedImages=[];this.domToResource=new WeakMap;elem.find(".button.cancel").on("click",this.close.bind(this));this.nameInput.on("input",this.onNameInput.bind(this));elem.on("change",".item input[type=checkbox]",this.toggleItem.bind(this))}_createClass(ComponentToPackageDialog,[{key:"onNameInput",value:function onNameInput(e){sanitizeFilenameInput(this.nameInput[0]);this.updateOKButton()}},{key:"updateOKButton",value:function updateOKButton(){this.okButton.toggleClass("disable",this.nameInput.val().trim().length==0)}},{key:"toggleItem",value:function toggleItem(e){var checkbox=$(e.target);var item=checkbox.closest(".item");item.toggleClass("checked",e.target.checked)}},{key:"open",value:function open(options){var component=options.component;var elements=domTreeToArray(component.element[0]);var userCSS=app.context.getUserCSS();for(var i=0;i<userCSS.length;i++){for(var j=0;j<elements.length;j++){if(userCSS[i].matchesElement(elements[j])){if(this.usedCSS.indexOf(userCSS[i])==-1){this.usedCSS.push(userCSS[i])}}}}var usedImages=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.usedCSS[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var css=_step.value;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=app.context.assets.images.getAll()[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var img=_step4.value;var path=app.context.assets.images.getRelativePathForItem(img);if(css.isImageUsed(path)&&!this.usedImages.includes(path)){this.usedImages.push(path)}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=component.findUsedImages()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var image=_step2.value;var path=app.context.assets.images.getRelativePathForItem(image);if(!this.usedImages.includes(path)){this.usedImages.push(path)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.usedCSS[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var css=_step3.value;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=app.context.assets.fonts.getAll()[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var font=_step5.value;if(css.isFontUsed(font.name)&&this.usedFonts.indexOf(font)==-1){this.usedFonts.push(font)}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}this.nameInput.val("");_get(Object.getPrototypeOf(ComponentToPackageDialog.prototype),"open",this).call(this,options);this.nameInput.focus();this.okButton.addClass("disable")}},{key:"close",value:function close(){_get(Object.getPrototypeOf(ComponentToPackageDialog.prototype),"close",this).call(this);this.usedCSS=[];this.usedFonts=[];this.usedImages=[]}},{key:"afterClose",value:function afterClose(){this.element.find(".css-list").empty();this.element.find(".image-list").empty();this.element.find(".font-list").empty()}},{key:"onOK",value:function onOK(){if(!Resource.isNameValid(this.nameInput.val()))return;var blocks=[],fonts=[],usedImages=[],js=[],css=[];var images={};var that=this;this.element.find(".css-list .item.checked").each(function(){var block=that.domToResource.get(this).clone();var selector=this.querySelector("input[type=text]").value.trim();if(!selector.length)return;block.selector=selector;blocks.push(block)});var directCSS=new CSSResource("component.css");directCSS.addCSSBlocksAtIndex(blocks,0);css.push(directCSS);this.element.find(".stylesheet-list .item.checked").each(function(){css.push(that.domToResource.get(this))});this.element.find(".font-list .item.checked").each(function(){fonts.push(that.domToResource.get(this))});this.element.find(".image-list .item.checked").each(function(){usedImages.push(that.domToResource.get(this))});images=app.context.assets.images.filterTree(function(img){return usedImages.includes(img)});this.element.find(".js-list .item.checked").each(function(){js.push(that.domToResource.get(this))});this.options.onSubmit({name:this.nameInput.val(),fonts:fonts,images:images,css:css,js:js});this.close()}},{key:"update",value:function update(){var _this=this;var allImages=app.context.assets.images.getAll();var allFonts=app.context.assets.fonts.getAll();var allJS=app.context.assets.js.getAll();var allStylesheets=app.context.assets.css.getAllCSSResources();this.element.toggleClass("has-css",!!this.usedCSS.length);this.element.toggleClass("has-stylesheets",!!allStylesheets.length);this.element.toggleClass("has-images",!!allImages.length);this.element.toggleClass("has-fonts",!!allFonts.length);this.element.toggleClass("has-js",!!allJS.length);this.element.find(".css-list").html(this.usedCSS.map(function(css){return _this.createCSSItem(css)}));this.element.find(".stylesheet-list").html(allStylesheets.map(function(css){var path;if(!(css instanceof LinkResource)){path=app.context.assets.css.getRelativePathForItem(css)}return _this.createResourceItem(css,false,path)}));this.element.find(".image-list").html(allImages.map(function(img){var path=app.context.assets.images.getRelativePathForItem(img);return _this.createResourceItem(img,_this.usedImages.includes(path),path)}));this.element.find(".font-list").html(allFonts.map(function(font){var path=app.context.assets.fonts.getRelativePathForItem(font);return _this.createResourceItem(font,_this.usedFonts.indexOf(font)!=-1,path)}));this.element.find(".js-list").html(allJS.map(function(js){var path;if(!(js instanceof LinkResource)){path=app.context.assets.js.getRelativePathForItem(js)}return _this.createResourceItem(js,false,path)}))}},{key:"createResourceItem",value:function createResourceItem(resource){var checked=arguments.length<=1||arguments[1]===undefined?true:arguments[1];var path=arguments.length<=2||arguments[2]===undefined?"":arguments[2];var node=$('<label class="item white-item '+(checked?"checked":"")+'"><input type="checkbox" '+(checked?"checked":"")+" />"+escapeHTML(path||resource.name)+"</label>");this.domToResource.set(node[0],resource);node[0].title=path||resource.name;return node}},{key:"createCSSItem",value:function createCSSItem(block){if(!block.rules.length)return"";var html='<label class="item checked">\n\t\t\t\t<div class="left">\n\t\t\t\t\t<input type="checkbox" checked />\n\t\t\t\t</div>\n\n\t\t\t\t<div class="right">';if(block.mediaQuery){html+='\n\t\t\t\t<div class="media">\n\t\t\t\t\t<div class="open-query"><span>@media '+escapeHTML(block.mediaQuery)+"</span> {</div>\n\t\t\t"}html+='\n\t\t\t<div class="open-block">\n\t\t\t\t<span><input type="text" value="'+escapeHTML(block.selector)+'" /></span> {\n\t\t\t</div>';for(var i=0;i<block.rules.length;i++){html+='\n\t\t\t\t<div class="line"><span class="property">'+escapeHTML(block.rules[i].property)+'</span>: <span class="value">'+escapeHTML(block.rules[i].value)+";</span></div>\n\t\t\t"}html+='<div class="close-block">}</div>';if(block.mediaQuery){html+='\n\t\t\t\t<div class="close-query">}</div>\n\t\t\t</div>'}html+="\n\t\t\t</div>\n\t\t</label>";var node=$(html);this.domToResource.set(node[0],block);return node}}]);return ComponentToPackageDialog}(Dialog);module.exports=ComponentToPackageDialog},{"../components/base/Image":56,"../helpers/domTreeToArray":557,"../helpers/findInTree":564,"../helpers/sanitizeFilenameInput":605,"../resources/CSSResource":1249,"../resources/LinkResource":1255,"../resources/Resource":1256,"../tree/ImageResourceTreeGroup":1261,"./Dialog":498,"escape-html":1021}]
});
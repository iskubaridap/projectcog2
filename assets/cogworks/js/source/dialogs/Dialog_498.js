define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Point=require("../base/Point");var Dialog=function(){function Dialog(elem){_classCallCheck(this,Dialog);this.element=elem;this.background=elem.closest("#dialogs").find(".dialog-background");this.options={};this.element.find(".close").on("click",this.close.bind(this));this.element.on("mousedown",this.dialogMousedown.bind(this));app.on("resize",this.appResized.bind(this));this._updateFunc=function(){this.update()}.bind(this);this.mouseOffset=null;this.startPosition=null;this.lastPosition=null;this.currentOffset=new Point}_createClass(Dialog,[{key:"appResized",value:function appResized(){this.element[0].style.transform="";this.currentOffset=new Point;if(this.options.canBeMoved&&this.mouseOffset){var rect=this.element[0].getBoundingClientRect();this.startPosition=new Point(rect.left+this.mouseOffset.left,rect.top+this.mouseOffset.top)}}},{key:"dialogMousedown",value:function dialogMousedown(e){if(!this.options.canBeMoved)return;var target=$(e.target);if(!target.is(this.element)&&!target.is("h5"))return;var rect=this.element[0].getBoundingClientRect();this.mouseOffset={left:app.mousePosition.x-rect.left,right:rect.right-app.mousePosition.x,top:app.mousePosition.y-rect.top,bottom:rect.bottom-app.mousePosition.y};this.startPosition=app.mousePosition.clone().subtract(this.currentOffset);this.lastPosition=app.mousePosition.clone();app.on("mousemove.dialog-listener",this.dialogMousemove.bind(this));app.on("mouseup.dialog-listener",this.dialogMouseup.bind(this))}},{key:"dialogMousemove",value:function dialogMousemove(){var coordinates=app.mousePosition.clone();if(app.mousePosition.x+this.mouseOffset.right>window.innerWidth){coordinates.x=window.innerWidth-this.mouseOffset.right}if(app.mousePosition.y+this.mouseOffset.bottom>window.innerHeight){coordinates.y=window.innerHeight-this.mouseOffset.bottom}if(app.mousePosition.x-this.mouseOffset.left<0){coordinates.x=this.mouseOffset.left}if(app.mousePosition.y-this.mouseOffset.top<0){coordinates.y=this.mouseOffset.top}this.lastPosition=coordinates.clone();this.currentOffset=coordinates.subtract(this.startPosition);this.element[0].style.transform="translate3D("+this.currentOffset.x+"px,"+this.currentOffset.y+"px, 0)";this.element[0].classList.add("no-animation")}},{key:"dialogMouseup",value:function dialogMouseup(){this.startPosition=null;this.lastPosition=null;app.off(".dialog-listener");this.element[0].classList.remove("no-animation")}},{key:"open",value:function open(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];if(Dialog.stack.length&&Dialog.stack[Dialog.stack.length-1]instanceof this.constructor){return}for(var i=0;i<Dialog.stack.length;i++){if(Dialog.stack[i]instanceof this.constructor){Dialog.stack=Dialog.stack.slice(i+1);break}}this.options=Object.assign({showBackground:true,canBeMoved:false},options);this.show(true);if(Dialog.stack.length){Dialog.stack[Dialog.stack.length-1].hide(false)}Dialog.stack.push(this)}},{key:"resetState",value:function resetState(){this.options={};this.currentOffset=new Point;this.element[0].style.transform=""}},{key:"close",value:function close(e){var cb=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(!this.isVisible())return;Dialog.stack.pop();if(Dialog.stack.length){this.hide(false);Dialog.stack[Dialog.stack.length-1].show()}else{this.hide();this.background.off("click");this.background.fadeOut("fast")}this.options.onClose&&this.options.onClose();setTimeout(function(){this.afterClose();this.resetState();cb&&cb()}.bind(this),300)}},{key:"hide",value:function hide(){var animate=arguments.length<=0||arguments[0]===undefined?true:arguments[0];if(animate){this.element.fadeOut("fast")}else{this.element.hide()}}},{key:"isVisible",value:function isVisible(){return Dialog.stack.includes(this)&&this.element.is(":visible")}},{key:"show",value:function show(){var _this=this;var animate=arguments.length<=0||arguments[0]===undefined?true:arguments[0];if(animate){this.element.addClass("transparent-small").show();setTimeout(function(){_this.element.removeClass("transparent-small")},10)}else{this.element.show()}if(this.options.showBackground){this.background.fadeIn("fast")}else{this.background.hide();this.element.addClass("no-background")}this.update()}},{key:"afterClose",value:function afterClose(){}},{key:"update",value:function update(){}},{key:"scheduleUpdate",value:function scheduleUpdate(){var delay=arguments.length<=0||arguments[0]===undefined?20:arguments[0];clearTimeout(this._updateTimer);this._updateTimer=setTimeout(this._updateFunc,delay)}}],[{key:"closeAll",value:function closeAll(){if(!Dialog.isDialogShown()){return}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Dialog.stack[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var dialog=_step.value;(function(d){d.hide(false);setTimeout(function(){d.afterClose();d.resetState()},300)})(dialog)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}$("#dialogs").find(".dialog-background").off("click").fadeOut("fast");Dialog.stack.length=0}},{key:"isDialogShown",value:function isDialogShown(){return!!this.stack.length}},{key:"getShownDialog",value:function getShownDialog(){return this.stack[this.stack.length-1]}}]);return Dialog}();Dialog.stack=[];module.exports=Dialog},{"../base/Point":24}]
});
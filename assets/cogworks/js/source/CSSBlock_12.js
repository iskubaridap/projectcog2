define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var specificity=require("specificity");var isMQValid=require("valid-media-queries");var CSSRule=require("./CSSRule");var cleanSelectorsRegex=/:hover|:active|:visited|:before|:after|:target|:focus/gi;var pseudoSelectorsRegex=/:before|:after/;var stateSelectorsRegex=/:hover|:active|:visited|:target|:focus/;var normalizeCSSSelector=require("../helpers/normalizeCSSSelector");var specificityToNumber=require("../helpers/specificityToNumber");var escapeRegexString=require("../helpers/escapeRegexString");var globalID=1;var CSSBlock=function(){function CSSBlock(){var selector=arguments.length<=0||arguments[0]===undefined?"":arguments[0];var rules=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];var mediaQuery=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var system=arguments.length<=3||arguments[3]===undefined?false:arguments[3];_classCallCheck(this,CSSBlock);this.selector=selector;this.rules=rules;this.mediaQuery=mediaQuery;this.system=system;this.parentKeyframes=null;this.enabled=true;this.runtimeID=globalID++}_createClass(CSSBlock,[{key:"createRule",value:function createRule(){return new CSSRule}},{key:"setInKeyframes",value:function setInKeyframes(keyframes){this.parentKeyframes=keyframes}},{key:"isInKeyframes",value:function isInKeyframes(){return!!this.parentKeyframes}},{key:"isLocked",value:function isLocked(){return this.system||this.sass}},{key:"isEnabled",value:function isEnabled(){return this.enabled}},{key:"toggle",value:function toggle(){var enable=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(enable===null){enable=!this.enabled}this.enabled=enable}},{key:"toggleOp",value:function toggleOp(){var _this=this;var enable=arguments.length<=0||arguments[0]===undefined?null:arguments[0];var oldValue=this.enabled;return{do:function _do(){_this.toggle(enable)},undo:function undo(){_this.toggle(oldValue)}}}},{key:"getParentKeyframes",value:function getParentKeyframes(){return this.parentKeyframes}},{key:"getLinkedKeyframeNames",value:function getLinkedKeyframeNames(){var animationNames=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.rules[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var rule=_step.value;var property=rule.property.trim().toLowerCase();if(property=="animation"||property=="animation-name"){var animationName=rule.value.trim().split(/\s+/).shift();if(animationName){animationNames.push(animationName)}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return animationNames}},{key:"getPrettyName",value:function getPrettyName(){return this.selector}},{key:"getOrigin",value:function getOrigin(){if(this.system){return"Bootstrap"}var res=app.context.findResourceForCSSBlock(this);if(res){return res.name}return""}},{key:"canBeSelected",value:function canBeSelected(){return!this.isLocked()&&!this.isInKeyframes()}},{key:"canBeHighlighted",value:function canBeHighlighted(){return!this.isInKeyframes()}},{key:"stripImagePaths",value:function stripImagePaths(imagePaths){for(var path in imagePaths){var search=new RegExp(escapeRegexString(path),"g");var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.rules[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var rule=_step2.value;rule.value=rule.value.replace(search,imagePaths[path])}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}},{key:"findUsedImagePaths",value:function findUsedImagePaths(){var images=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.rules[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var rule=_step3.value;if(rule.isImageRelated()){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=rule.findUsedImagePaths()[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var image=_step4.value;if(!images.includes(image)){images.push(image)}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return images}},{key:"removeUnrelatedRules",value:function removeUnrelatedRules(property){this.rules=this.rules.filter(function(r){return r.isRelatedTo(property)})}},{key:"isImageUsed",value:function isImageUsed(imagePath){var regex=new RegExp("url\\(\\s*['\"]?"+escapeRegexString(imagePath)+"['\"]?\\s*\\)");for(var i=0;i<this.rules.length;i++){if(regex.test(this.rules[i].value)){return true}}return false}},{key:"isFontUsed",value:function isFontUsed(font){var propertyRegex=/^(?:font-family|font)$/i;var valueRegex=new RegExp("\\b"+escapeRegexString(font)+"\\b","i");for(var i=0;i<this.rules.length;i++){if(propertyRegex.test(this.rules[i].property)&&valueRegex.test(this.rules[i].value)){return true}}return false}},{key:"toString",value:function toString(){var prop=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(!this.isEnabled())return"";if(!this.selector)return"";var tmp="\n";for(var i=0;i<this.rules.length;i++){tmp+=this.rules[i].toString(prop)}if(this.mediaQuery!==false){return"@media "+this.mediaQuery+" {\n  "+this.selector+" {"+tmp.replace(/^  /gm,"    ")+"  }\n"+"}\n"}if(this.isInKeyframes()){return"  "+this.selector+" {"+tmp.replace(/^  /gm,"    ")+"  }\n"}return this.selector+" {"+tmp+"}\n"}},{key:"calculateSpecificityFor",value:function calculateSpecificityFor(element){var max=0,specificity;var isPseudo=true;var isState=true;var selectors=[];for(var i=0;i<this.specificity.length;i++){try{if(element.matches(this.specificity[i].selector.replace(cleanSelectorsRegex,""))){specificity=specificityToNumber(this.specificity[i].specificity);if(specificity>max){max=specificity}if(!pseudoSelectorsRegex.test(this.specificity[i].selector)){isPseudo=false}if(!stateSelectorsRegex.test(this.specificity[i].selector)){isState=false}selectors.push({selector:normalizeCSSSelector(this.specificity[i].selector),specificity:specificity})}}catch(e){return false}}if(!selectors.length){return false}return{specificity:max,isPseudo:isPseudo,isState:isState,selectors:selectors}}},{key:"matchesElement",value:function matchesElement(element){try{return element.matches(this.selector.replace(cleanSelectorsRegex,""))}catch(e){return false}}},{key:"previewControl",value:function previewControl(){var props=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var block=this;var skipAnimationProperties=true;if("skipAnimationProperties"in props){skipAnimationProperties=props.skipAnimationProperties}return{set:function set(){var css=app.context.prepareCSSOverrideString(block.toString({skipAnimationProperties:skipAnimationProperties}));app.canvas.setCSSOverride(css)},clear:function clear(){app.canvas.resetCSSOverride()}}}},{key:"updateRuleOp",value:function updateRuleOp(prop,newValue){var rule=this.getRuleByProperty(prop);var ruleExists=!!rule;var deleteRule=false;var oldValue;if(ruleExists){oldValue=rule.value}else{rule=new CSSRule;rule.property=prop;rule.value=newValue}if(!newValue){deleteRule=true}var that=this;return{do:function _do(){if(ruleExists){if(deleteRule){that.removeRule(rule)}else{rule.value=newValue}}else{if(deleteRule){return}that.addSmart(rule)}},undo:function undo(){if(ruleExists){if(deleteRule){that.addSmart(rule)}else{rule.value=oldValue}}else{if(deleteRule){return}that.removeRule(rule)}}}}},{key:"getRuleByProperty",value:function getRuleByProperty(prop){prop=prop.trim().toLowerCase();for(var i=this.rules.length-1;i>=0;i--){if(this.rules[i].property.trim().toLowerCase()==prop){return this.rules[i]}}return null}},{key:"addSmart",value:function addSmart(rule){var index=this.rules.indexOf(rule);if(index>-1){return false}for(var i=0;i<this.rules.length;i++){var child=this.rules[i];if(child.isLonghandOf(rule.property)){this.addAtIndex(rule,i);return}}this.rules.push(rule)}},{key:"removeRule",value:function removeRule(rule){var index=this.rules.indexOf(rule);if(index==-1){return false}return this.removeIndex(index)}},{key:"addAtIndex",value:function addAtIndex(rules,index){if(!Array.isArray(rules))rules=[rules];Array.prototype.splice.apply(this.rules,[index,0].concat(rules))}},{key:"removeIndex",value:function removeIndex(index){this.rules.splice(index,1)}},{key:"applyStyles",value:function applyStyles(){}},{key:"cloneAsUserBlock",value:function cloneAsUserBlock(){var newBlock=this.clone();newBlock.system=false;newBlock.sass=false;newBlock.rules.forEach(function(r){return r.system=false});return newBlock}},{key:"clone",value:function clone(){var newBlock=new CSSBlock(this.selector,this.rules.map(function(rule){return rule.clone()}),this.mediaQuery);newBlock.system=this.system;newBlock.sass=this.sass;newBlock.enabled=this.enabled;return newBlock}},{key:"isMediaQueryValid",value:function isMediaQueryValid(){return isMQValid("@media "+this.mediaQuery)}},{key:"isInheritable",
value:function isInheritable(){for(var i=0;i<this.rules.length;i++){if(this.rules[i].isInheritable())return true}return false}},{key:"isUserEmpty",value:function isUserEmpty(){return!this.system&&this.rules.length==0}},{key:"cleanEmptyRules",value:function cleanEmptyRules(){this.rules=this.rules.filter(function(r){return!r.isEmpty()})}},{key:"serialize",value:function serialize(){return{selector:this.selector,mediaQuery:this.mediaQuery,system:this.system,enabled:this.enabled,rules:this.rules.map(function(r){return r.serialize()})}}},{key:"unserialize",value:function unserialize(obj){this.selector=obj.selector;this.mediaQuery=obj.mediaQuery;this.system=obj.system||false;this.enabled=obj.enabled;this.rules=obj.rules.map(function(r){var tmp=new CSSRule;tmp.unserialize(r);return tmp})}},{key:"selector",get:function get(){return this._selector},set:function set(val){this._selector=normalizeCSSSelector(val);this.specificity=specificity.calculate(val)}}]);return CSSBlock}();CSSBlock.isSelectorValid=function(selector){try{document.querySelector(selector);return true}catch(e){return false}};module.exports=CSSBlock},{"../helpers/escapeRegexString":561,"../helpers/normalizeCSSSelector":590,"../helpers/specificityToNumber":615,"./CSSRule":15,"specificity":1165,"valid-media-queries":1199}]
});
define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x3,_x4,_x5){var _again=true;_function:while(_again){var object=_x3,property=_x4,receiver=_x5;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x3=parent;_x4=property;_x5=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}else{return Array.from(arr)}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Component=require("./Component");var canParentTakeChildren=require("../../helpers/canParentTakeChildren");var findInTreeCallback=require("../../helpers/findInTreeCallback");var getSmartProp=require("../../helpers/getSmartProp");var componentTreeToArray=require("../../helpers/componentTreeToArray");var ChildAddBar=require("../../bars/ChildAddBar");var ComponentWithChildren=function(_Component){_inherits(ComponentWithChildren,_Component);function ComponentWithChildren(){_classCallCheck(this,ComponentWithChildren);_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"constructor",this).call(this);this.children=[];this._instanceCache={};this.defineActions([{label:"Paste Inside",action:this.pasteInsideAction.bind(this),visible:this.canReceivePaste.bind(this),showInContextMenu:true,weight:94},{label:"Paste Linked",action:this.pasteLinkedAction.bind(this),visible:this.canReceiveLinkedPaste.bind(this),showInContextMenu:true,weight:94}]);this.childPropertyCache=new WeakMap}_createClass(ComponentWithChildren,[{key:"childAt",value:function childAt(index){return this.children[index]}},{key:"childIndex",value:function childIndex(child){return this.children.indexOf(child)}},{key:"isChildFocused",value:function isChildFocused(){return this.exists()&&this.page().getFocusedComponent()&&this.page().getFocusedComponent().isChildOf(this)}},{key:"findFirstComponentChild",value:function findFirstComponentChild(){return this.children[0]||false}},{key:"findNextComponentChild",value:function findNextComponentChild(current){var currentIndex=this.childIndex(current);return this.children[currentIndex+1]||false}},{key:"findPreviousComponentChild",value:function findPreviousComponentChild(current){var currentIndex=this.childIndex(current);return this.children[currentIndex-1]||false}},{key:"canReceivePaste",value:function canReceivePaste(){var data=app.context.page.parseClipboardRepresentation(electron.clipboardGetHTML());if(!data||!data.component)return false;return canParentTakeChildren(this,data.component)}},{key:"canReceiveLinkedPaste",
value:function canReceiveLinkedPaste(){if(this.linkID||this.hasLinkedParent())return false;var data=app.context.page.parseClipboardRepresentation(electron.clipboardGetHTML());if(!data||!data.linkID)return false;var origin=app.context.getCopyOrigin(data.linkID);if(!origin)return false;if(origin.hasLinkedParent())return false;return canParentTakeChildren(this,origin)}},{key:"pasteInsideAction",value:function pasteInsideAction(){if(!this.canReceivePaste())return;var data=app.context.page.parseClipboardRepresentation(electron.clipboardGetHTML());var copy=data.component;if(this.linkID||this.hasLinkedParent()){copy.cleanup()}else{this.context().scanTreeForLinkedComponents(copy)}this.insertLast(copy);this.update();var that=this;app.context.history.add({name:"Paste Component",undo:function undo(){copy.remove();that.update()},redo:function redo(){that.insertLast(copy);that.update()}})}},{key:"pasteLinkedAction",value:function pasteLinkedAction(){if(!this.canReceiveLinkedPaste())return;var data=app.context.page.parseClipboardRepresentation(electron.clipboardGetHTML());var origin=app.context.getCopyOrigin(data.linkID),copy=origin.clone().cleanup();copy.linkTo(origin);this.insertLast(copy);this.update();var that=this;app.context.history.add({name:"Paste Linked Component",undo:function undo(){copy.remove();that.update()},redo:function redo(){that.insertLast(copy);that.update()}})}},{key:"createOrSelectInstance",value:function createOrSelectInstance(type){var name=type.name;if(this._instanceCache[name]){return this._instanceCache[name]}for(var i=0;i<this.children.length;i++){if(this.children[i]instanceof type){this._instanceCache[name]=this.children[i];return this.children[i]}}this._instanceCache[name]=new type;this._instanceCache[name].initialize();this._instanceCache[name].fixate();return this._instanceCache[name]}},{key:"createCheckBoxForSubComponent",value:function createCheckBoxForSubComponent(property,title,type,insertAction){var CheckBoxOption=require("../../panels/CheckBoxOption");var component=this;return new CheckBoxOption({label:"Show "+title,value:[component.properties,property],onChange:function onChange(val,oldVal){var instance=component.createOrSelectInstance(type);if(val){insertAction(component,instance);component.update();app.context.history.add({name:"Show "+title,undo:function undo(){component.properties[property]=oldVal;instance.remove();component.update()},redo:function redo(){component.properties[property]=val;insertAction(component,instance);component.update()}})}else{var index=component.childIndex(instance);instance.remove();component.update();app.context.history.add({name:"Hide "+title,undo:function undo(){component.properties[property]=oldVal;insertAction(component,instance,index);component.update()},redo:function redo(){component.properties[property]=val;instance.remove();component.update()}})}}})}},{key:"hoverDrag",value:function hoverDrag(){var offset=arguments.length<=0||arguments[0]===undefined?10:arguments[0];if(!canParentTakeChildren(this,app.draggedComponents)){return this.parent&&this.parent.hoverDrag(offset)}if(!this.isPointWithinOffset(app.canvas.mousePosition,offset)&&this.parent){return this.parent.hoverDrag(offset)}app.canvas.highlight(this);var children=this.children;if(!children.length){app.dropCall={object:this,method:"insertLast",arguments:[app.draggedComponents]};return true}var minDistance=Infinity,closest=null,tmp;for(var i=0;i<children.length;i++){tmp=children[i].distanceToPoint(app.canvas.mousePosition);if(tmp<minDistance){minDistance=tmp;closest=children[i]}}if(!closest)return;var elementToTheLeft=false,elementToTheRight=false,elementToTheTop=false,elementToTheBottom=false;var leftDistance=Infinity,bottomDistance=Infinity,rightDistance=Infinity,topDistance=Infinity;var centerClosest=closest.x+closest.width/2,centerChild;for(var i=0;i<children.length;i++){if(children[i]===closest)continue;centerChild=children[i].x+children[i].width/2;if(closest.onTheSameRowWith(children[i])){if(centerClosest>=centerChild&&closest.x-children[i].x2<100){elementToTheLeft=true;leftDistance=Math.min(Math.max(closest.x-children[i].x2,0),leftDistance)}if(centerChild>=centerClosest&&children[i].x-closest.x2<100){elementToTheRight=true;rightDistance=Math.min(Math.max(children[i].x-closest.x2,0),rightDistance)}}else if(closest.onTheSameColumnWith(children[i])){if(closest.y>=children[i].y2&&closest.y-children[i].y2<100){elementToTheTop=true;topDistance=Math.min(closest.y-children[i].y2,topDistance)}if(children[i].y>=closest.y2&&children[i].y-closest.y2<100){elementToTheBottom=true;bottomDistance=Math.min(children[i].y-closest.y2,bottomDistance)}}}var hoverOffsetX=0;var hoverOffsetY=0;app.dropCall={object:this,method:null,arguments:null};if(closest.distanceToPoint(app.canvas.mousePosition)==0){hoverOffsetX=Math.min(closest.width/3,40);hoverOffsetY=Math.min(closest.height/3,40)}if(app.canvas.mousePosition.x<=closest.x+hoverOffsetX){app.dropCall.method="insertBefore";app.dropCall.arguments=[app.draggedComponents,closest];if(elementToTheLeft){app.canvas.drawVerticalLine(closest.x-leftDistance/2,closest.y,closest.height,"left right")}else{app.canvas.drawVerticalLine(closest.x,closest.y,closest.height,"left")}}else if(app.canvas.mousePosition.x>=closest.x2-hoverOffsetX){app.dropCall.method="insertAfter";app.dropCall.arguments=[app.draggedComponents,closest];if(elementToTheRight){app.canvas.drawVerticalLine(closest.x2+rightDistance/2,closest.y,closest.height,"left right")}else{app.canvas.drawVerticalLine(closest.x2,closest.y,closest.height,"right")}}else if(app.canvas.mousePosition.y<=closest.y+hoverOffsetY){app.dropCall.method="insertBefore";app.dropCall.arguments=[app.draggedComponents,closest];if(elementToTheTop){app.canvas.drawHorizontalLine(closest.x,closest.y-topDistance/2,closest.width,"top bottom")}else{app.canvas.drawHorizontalLine(closest.x,closest.y,closest.width,"top")}}else if(app.canvas.mousePosition.y>=closest.y2-hoverOffsetY){app.dropCall.method="insertAfter";app.dropCall.arguments=[app.draggedComponents,closest];if(elementToTheBottom){app.canvas.drawHorizontalLine(closest.x,closest.y2+bottomDistance/2,closest.width,"top bottom")}else{app.canvas.drawHorizontalLine(closest.x,closest.y2,closest.width,"bottom")}}else{app.dropCall=null}return true}},{key:"hasChild",value:function hasChild(type){for(var i=0;i<this.children.length;i++){if(this.children[i]instanceof type)return true;if(this.children[i].hasChild(type))return true}return false}},{key:"hasChildren",value:function hasChildren(){return this.children.length>0}},{key:"getChildFor",value:function getChildFor(comp){if(!comp)return null;if(comp.parent==this)return comp;var parent=comp;while(parent=parent.parent){if(parent.parent==this){return parent}}return null}},{key:"canTakeChild",value:function canTakeChild(component){return true}},{key:"canTakeChildren",value:function canTakeChildren(components){return true}},{key:"insertFirst",value:function insertFirst(components){var _children;if(Array.isArray(components)){components=components.slice()}else{components=[components]}for(var i=0;i<components.length;i++){this.adoptChild(components[i])}(_children=this.children).unshift.apply(_children,_toConsumableArray(components));return true}},{key:"insertLast",value:function insertLast(components){var _children2;if(Array.isArray(components)){components=components.slice()}else{components=[components]}for(var i=0;i<components.length;i++){this.adoptChild(components[i])}(_children2=this.children).push.apply(_children2,_toConsumableArray(components));return true}},{key:"insertBefore",value:function insertBefore(components,componentToInsertBefore){var _children3;if(Array.isArray(components)){components=components.slice()}else{components=[components]}var index=this.childIndex(componentToInsertBefore);if(index==-1)return false;if(components.indexOf(componentToInsertBefore)>-1){return true}for(var i=0;i<components.length;i++){this.adoptChild(components[i])}(_children3=this.children).splice.apply(_children3,[this.childIndex(componentToInsertBefore),0].concat(_toConsumableArray(components)));return true}},{key:"insertAfter",value:function insertAfter(components,componentToInsertAfter){var _children4;if(Array.isArray(components)){components=components.slice()}else{components=[components]}if(components.indexOf(componentToInsertAfter)>-1){return true}var index=this.childIndex(componentToInsertAfter);if(index==-1)return false;for(var i=0;i<components.length;i++){this.adoptChild(components[i])}(_children4=this.children).splice.apply(_children4,[this.childIndex(componentToInsertAfter)+1,0].concat(_toConsumableArray(components)));return true}},{key:"insertAt",value:function insertAt(components,index){var _children5;if(index>this.children.length){return false}if(Array.isArray(components)){components=components.slice()}else{components=[components]}for(var i=0;i<components.length;i++){this.adoptChild(components[i])}(_children5=this.children).splice.apply(_children5,[index,0].concat(_toConsumableArray(components)));return true}},{key:"removeChild",value:function removeChild(component){this.undrop(component);if(this.children.length==0)return false;var index=this.children.indexOf(component);if(index==-1)return false;this.children.splice(index,1);if(component.parent){component.parent=null}return true}},{key:"empty",value:function empty(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;child.parent=null}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}this.children.length=0;this._instanceCache={}}},{key:"adoptChild",value:function adoptChild(component){if(component.parent){component.parent.removeChild(component)}this.drop(component);component.parent=this;return true}},{key:"insertLastOp",value:function insertLastOp(component){var additionalAction=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(!canParentTakeChildren(this,component)){return null}var that=this;return{undo:function undo(){component.remove()},do:function _do(){if(additionalAction){additionalAction(component)}that.insertLast(component)}}}},{key:"onChildUpdate",value:function onChildUpdate(){}},{key:"injectChildOptions",value:function injectChildOptions(child){}},{key:"getAllUserClassNames",value:function getAllUserClassNames(){var classNames=_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"getAllUserClassNames",this).call(this);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var child=_step2.value;classNames.push.apply(classNames,_toConsumableArray(child.getAllUserClassNames()))}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return classNames}},{key:"createToolbar",value:function createToolbar(comp){var _this=this;if(Array.isArray(this.constructor.suggestedComponents)&&this.constructor.suggestedComponents.length&&comp==this){var bar=new ChildAddBar(this);var suggested=this.constructor.suggestedComponents.map(function(c){return app.framework.getComponent(c)});suggested=suggested.filter(function(Child){var child=new Child;return canParentTakeChildren(_this,child)});if(!suggested.length){return null}bar.initialize({children:suggested});return bar}return null}},{key:"hasChildPropertyChanged",value:function hasChildPropertyChanged(child,key,prop){if(!this.childPropertyCache.has(child)){this.childPropertyCache.set(child,_defineProperty({},key,getSmartProp(prop)));return false}var cache=this.childPropertyCache.get(child);if(cache[key]==getSmartProp(prop)){return false}cache[key]=getSmartProp(prop);return true}},{key:"findChildrenOfType",value:function findChildrenOfType(type){return findInTreeCallback(function(c){return c instanceof type},this)}},{key:"stripImagePaths",value:function stripImagePaths(imagePaths){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.children[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var child=_step3.value;child.stripImagePaths(imagePaths)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"findUsedImages",value:function findUsedImages(){var images=_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"findUsedImages",this).call(this);var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.children[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var child=_step4.value;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=child.findUsedImages()[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var image=_step5.value;if(!images.includes(image)){images.push(image)}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}return images}},{key:"replaceTemplatePlaceholders",value:function replaceTemplatePlaceholders(placeholders){var InlineCharacter=require("./InlineCharacter");var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.children[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var child=_step6.value;if(!(child instanceof InlineCharacter)){child.replaceTemplatePlaceholders(placeholders)}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]){_iterator6["return"]()}}finally{if(_didIteratorError6){throw _iteratorError6}}}}},{key:"beforeDrop",value:function beforeDrop(){return false}},{key:"drop",value:function drop(component){}},{key:"undrop",value:function undrop(component){}},{key:"unlinkAll",value:function unlinkAll(){_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"unlinkAll",this).call(this);findInTreeCallback(function(c){return c.linkID},this).forEach(function(c){return c.unlink()})}},{key:"softUnlinkAll",value:function softUnlinkAll(){_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"softUnlinkAll",this).call(this);findInTreeCallback(function(c){return c.linkID},this).forEach(function(c){return c.softUnlink()})}},{key:"remove",value:function remove(){this.unlinkAll();_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"remove",this).call(this)}},{key:"redirectFocus",value:function redirectFocus(){_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"redirectFocus",this).call(this);this.redirectChildFocus()}},{key:"redirectChildFocus",value:function redirectChildFocus(){if(this.page().hasFocusedComponent()&&this.page().getFocusedComponent().isChildOf(this)){if(this.parent){this.parent.focus()}else{app.canvas.html.body.focus()}}}},{key:"startUpdate",value:function startUpdate(){var elem=this.element[0];while(elem.firstChild){elem.removeChild(elem.firstChild)}var fragment=document.createDocumentFragment();if(this.children.length){for(var i=0;i<this.children.length;i++){var child=this.children[i];var childNode=child.update()[0];var context=this.context();if(context.isExport&&context.exportOptions.exportLabels&&child.label){fragment.appendChild(document.createComment(" Start: "+child.label+" "));fragment.appendChild(childNode);fragment.appendChild(document.createComment(" End: "+child.label+" "))}else{fragment.appendChild(childNode)}}}this.element[0].appendChild(fragment);_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"startUpdate",this).call(this)}},{key:"updateDimensions",value:function updateDimensions(){_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"updateDimensions",this).call(this);this.children.forEach(function(child){return child.updateDimensions()})}},{key:"cleanup",value:function cleanup(){_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"cleanup",this).call(this);var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=this.children[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var child=_step7.value;child.cleanup()}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7["return"]){_iterator7["return"]()}}finally{if(_didIteratorError7){throw _iteratorError7}}}return this}},{key:"overwrite",value:function overwrite(json){this.redirectChildFocus();var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=this.children[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var child=_step8.value;child.parent=null}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally{try{if(!_iteratorNormalCompletion8&&_iterator8["return"]){_iterator8["return"]()}}finally{if(_didIteratorError8){throw _iteratorError8}}}this.children.length=0;_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"overwrite",this).call(this,json)}},{key:"serialize",value:function serialize(){var obj=_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"serialize",this).call(this);obj.children=this.children.map(function(c){return c.serialize()});return obj}},{key:"unserialize",value:function unserialize(json){_get(Object.getPrototypeOf(ComponentWithChildren.prototype),"unserialize",this).call(this,json);var page=this.page();if(Array.isArray(json.children)){var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=json.children[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var childJSON=_step9.value;this.insertLast(page.restoreComponentTree(childJSON,this))}}catch(err){_didIteratorError9=true;_iteratorError9=err}finally{try{if(!_iteratorNormalCompletion9&&_iterator9["return"]){_iterator9["return"]()}}finally{if(_didIteratorError9){throw _iteratorError9}}}}}}]);return ComponentWithChildren}(Component);module.exports=ComponentWithChildren},{"../../bars/ChildAddBar":2,"../../helpers/canParentTakeChildren":547,"../../helpers/componentTreeToArray":551,"../../helpers/findInTreeCallback":565,"../../helpers/getSmartProp":575,"../../panels/CheckBoxOption":1213,"./Component":39,"./InlineCharacter":57}]
});
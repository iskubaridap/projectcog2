define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var OptionItem=require("./OptionItem");var ButtonOption=require("../panels/ButtonOption");var LinkOption=require("../panels/LinkOption");var getSmartProp=require("../helpers/getSmartProp");var setSmartProp=require("../helpers/setSmartProp");var verticalDragReorderHandler=require("../helpers/verticalDragReorderHandler");var ComponentListOption=function(_OptionItem){_inherits(ComponentListOption,_OptionItem);function ComponentListOption(options){_classCallCheck(this,ComponentListOption);_get(Object.getPrototypeOf(ComponentListOption.prototype),"constructor",this).call(this,options);this.component=options.component;this.formFields=[];this.element=$('<div class="component-list-option">'+"<ul></ul>"+'<div class="form-holder"></div> <a class="add-button button darkgray">Add</a>'+"</div>");this.domNodeToComponent=new WeakMap;this.addForm=options.addForm;this.editForm=options.editForm;this.onFormSave=options.onFormSave;this.addClick=options.addClick;this.itemRepresentation=options.itemRepresentation||function(){};this.reorderHandler=verticalDragReorderHandler({itemSelector:"li",reorder:this.reorder.bind(this)})}_createClass(ComponentListOption,[{key:"bindEventListeners",value:function bindEventListeners(){this.element.off();this.element.on("mousedown","li .handle",this.handleMousedown.bind(this));this.element.on("click","li .edit",this.editClick.bind(this));this.element.on("click","li .delete",this.deleteClick.bind(this));this.element.on("click","li span",this.spanClick.bind(this));this.element.on("click",".add-button",this.addButtonClick.bind(this));this.element.on("mouseup",this.mouseup.bind(this));this.element.on("mouseleave",this.mouseleave.bind(this));this.element.on("mousemove",this.mousemove.bind(this))}},{key:"shouldShow",value:function shouldShow(type,item){if(!(type in this._options.actions)){return false}if(typeof this._options.actions[type]=="boolean"){return this._options.actions[type]}if(typeof this._options.actions[type].condition=="function"){return this._options.actions[type].condition(item)}return false}},{key:"hasAction",value:function hasAction(type){return type in this._options.actions&&typeof this._options.actions[type].action=="function"}},{key:"executeAction",value:function executeAction(type,param){return this._options.actions[type].action(param)}},{key:"getItems",value:function getItems(){return getSmartProp(this._options.items)}},{key:"setItems",value:function setItems(val){return setSmartProp(this._options.items,val)}},{key:"addButtonClick",value:function addButtonClick(){if(this.addForm){this.showAddForm()}else if(this.addClick){this.addClick()}}},{key:"showAddForm",value:function showAddForm(){var formHolder=this.element.find(".form-holder");formHolder.empty().show();var that=this;this.formFields=this.addForm();var button=new ButtonOption({text:"Create",onClick:function onClick(){var item=that.onFormSave(that.formFields);var oldItems=that.getItems();var newItems=oldItems.slice();newItems.push(item);that.setItems(newItems);that.component.update();app.context.history.add({name:"Create New "+that.component.getName()+" Entry",undo:function undo(){that.setItems(oldItems);that.component.update()},redo:function redo(){that.setItems(newItems);that.component.update()}})}});var link=new LinkOption({text:"Cancel",onClick:function onClick(){that.hideForm();that.removeHighlight()}});this.formFields.forEach(function(f){return formHolder.append(f.update())});formHolder.append(button.update());formHolder.append(link.update())}},{key:"showEditForm",value:function showEditForm(component){var formHolder=this.element.find(".form-holder");formHolder.empty().show();var that=this;this.formFields=this.editForm(component);var button=new ButtonOption({text:"Save Item",onClick:function onClick(){var items=that.getItems().slice();var index=items.indexOf(component);var oldItem=component;var newItem=that.onFormSave(that.formFields);items[index]=newItem;that.setItems(items);that.component.update();app.context.history.add({name:"Edit "+that.component.getName()+" Entry",undo:function undo(){items[index]=oldItem;that.setItems(items);that.component.update()},redo:function redo(){items[index]=newItem;that.setItems(items);that.component.update()}})}});var link=new LinkOption({text:"Cancel",onClick:function onClick(){that.hideForm();that.removeHighlight()}});this.formFields.forEach(function(f){return formHolder.append(f.update())});formHolder.append(button.update());formHolder.append(link.update())}},{key:"hideForm",value:function hideForm(){var formHolder=this.element.find(".form-holder");this.formFields=[];formHolder.empty().hide()}},{key:"removeHighlight",value:function removeHighlight(){this.element.find(".highlighted").removeClass("highlighted")}},{key:"mouseleave",value:function mouseleave(){this.reorderHandler.mouseup()}},{key:"mouseup",value:function mouseup(e){this.reorderHandler.mouseup()}},{key:"reorder",value:function reorder(){var option=this;var newItems=[];var oldItems=this.getItems().slice();var ul=this.element.find("ul")[0];for(var i=0;i<ul.children.length;i++){newItems.push(this.domNodeToComponent.get(ul.children[i]))}this.setItems(newItems);this.component.update();app.context.history.add({name:"Reorder "+this.component.getName()+" Items",undo:function undo(){option.setItems(oldItems);option.component.update()},redo:function redo(){option.setItems(newItems);option.component.update()}})}},{key:"editClick",value:function editClick(e){var component=this.domNodeToComponent.get(e.currentTarget.parentNode);if(this.hasAction("edit")){return this.executeAction("edit",component)}else if(this.editForm){this.element.find(".highlighted").removeClass("highlighted");e.currentTarget.parentNode.classList.add("highlighted");this.showEditForm(component)}}},{key:"deleteClick",value:function deleteClick(e){var component=this.domNodeToComponent.get(e.currentTarget.parentNode);if(this.hasAction("delete")){return this.executeAction("delete",component)}this.hideForm();var items=this.getItems().slice();var oldItems=items.slice();var index=items.indexOf(component);if(index==-1){return}items.splice(index,1);this.setItems(items);this.component.update();var option=this;app.context.history.add({name:"Delete "+this.component.getName()+" Item",undo:function undo(){option.setItems(oldItems);option.component.update()},redo:function redo(){option.setItems(items);option.component.update()}})}},{key:"spanClick",value:function spanClick(e){if(!this.editForm){return false}this.hideForm();var component=this.domNodeToComponent.get(e.currentTarget.parentNode);this.element.find(".highlighted").removeClass("highlighted");e.currentTarget.parentNode.classList.add("highlighted");this.showEditForm(component)}},{key:"handleMousedown",value:function handleMousedown(e){this.hideForm();this.reorderHandler.mousedown(e);this.removeHighlight()}},{key:"mousemove",value:function mousemove(e){this.reorderHandler.mousemove(e)}},{key:"update",value:function update(){_get(Object.getPrototypeOf(ComponentListOption.prototype),"update",this).call(this);var li,ul=$("<ul>"),items=this.getItems();for(var i=0;i<items.length;i++){li=$('<li class="gray-item"><i class="handle"></i><span class="name"></span></li>');li.find("span").text(this.itemRepresentation(items[i]));if(this.shouldShow("delete",items[i])){li.append('<b class="delete">&times;</b>')}if(this.shouldShow("edit",items[i])){li.append('<b class="edit"><i class="material-icons">mode_edit</i></b>')}this.domNodeToComponent.set(li[0],items[i]);ul.append(li)}this.element.find("ul").replaceWith(ul);this.element.find(".form-holder").empty();this.bindEventListeners();return this.element}}]);return ComponentListOption}(OptionItem);module.exports=ComponentListOption},{"../helpers/getSmartProp":575,"../helpers/setSmartProp":611,"../helpers/verticalDragReorderHandler":620,"../panels/ButtonOption":1212,"../panels/LinkOption":1225,"./OptionItem":1229}]
});
define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x3,_x4,_x5){var _again=true;_function:while(_again){var object=_x3,property=_x4,receiver=_x5;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x3=parent;_x4=property;_x5=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SubBar=require("./SubBar");var equal=require("deep-equal");var keyChecker=require("../helpers/keyChecker");var htmlToInline=require("../helpers/htmlToInline");var inlineToHTML=require("../helpers/inlineToHTML");var InlineEditingBar=function(_SubBar){_inherits(InlineEditingBar,_SubBar);function InlineEditingBar(component){_classCallCheck(this,InlineEditingBar);_get(Object.getPrototypeOf(InlineEditingBar.prototype),"constructor",this).call(this,component);this.weight=100;this.element=$('\n\t\t\t<div id="inline-editing-bar">\n\t\t\t\t\n\t\t\t\t<span class="button darkgray bold" data-id="bold" title="Bold"><i class="material-icons">format_bold</i></span>\n\t\t\t\t<span class="button darkgray italic" data-id="italic" title="Italic"><i class="material-icons">format_italic</i></span>\n\t\t\t\t<span class="button darkgray underline" data-id="underline" title="Underline"><i class="material-icons">format_underline</i></span>\n\t\t\t\t<span class="button darkgray strike" data-id="strike" title="Strikethrough"><i class="material-icons">format_strikethrough</i></span>\n\t\t\t\t<span class="button darkgray link" title="Link"><i class="material-icons">link</i></span>\n\t\t\t\t<span class="button darkgray clear-styles" title="Clear Formatting"><i class="material-icons">format_clear</i></span>\n\n\t\t\t\t<a class="button darkgray save">Apply</a>\n\t\t\t\t<a class="button darkgray discard">Discard</a>\n\n\t\t\t\t<a class="button darkgray character-input">Char Input</a>\n\t\t\t</div>\n\t\t');this.setDefault();this.keyDownListener=this.keydown.bind(this);this.selectionChangeListener=this.selectionChange.bind(this);this.pasteListener=this.paste.bind(this)}_createClass(InlineEditingBar,[{key:"bindEventListeners",value:function bindEventListeners(){this.element.on("click","span",this.onModifierClick.bind(this));this.element.on("click","a.discard",this.discardChanges.bind(this));this.element.on("click","a.save",this.commitChanges.bind(this));this.element.on("click","a.character-input",this.clickCharInput.bind(this));app.on("keydown",this.keyDownListener);app.on("selectionchange",this.selectionChangeListener);app.on("paste",this.pasteListener)}},{key:"unbindEventListeners",value:function unbindEventListeners(){this.element.off();app.off("keydown",this.keyDownListener);app.off("selectionchange",this.selectionChangeListener);app.off("paste",this.pasteListener)}},{key:"clickCharInput",value:function clickCharInput(){var that=this;app.characterInputDialog.open({showBackground:false,canBeMoved:true,onInsert:function onInsert(txt){that.executeEditingCommand("insertText",txt)}})}},{key:"selectionChange",value:function selectionChange(){this.bold=this.queryEditingCommandState("bold");this.italic=this.queryEditingCommandState("italic");this.strike=this.queryEditingCommandState("strikeThrough");this.underline=this.queryEditingCommandState("underline");this.link=false;var selection=app.canvas.iframeWin[0].getSelection();if(selection.rangeCount){var range=selection.getRangeAt(0);if(range.startContainer){var link=null;var elem=range.startContainer;while(elem&&elem!=this.component.element[0]){if(elem.nodeName=="A"){link=elem;break}elem=elem.parentNode}if(link){var elem=range.endContainer;while(elem){if(elem==link){this.link=elem.hasAttribute("href")?elem.getAttribute("href"):"";break}elem=elem.parentNode}}}}this.update()}},{key:"paste",value:function paste(e){e.preventDefault();var clipboard=e.originalEvent.clipboardData;var data=clipboard.getData("text/html");if(data){var html=inlineToHTML(htmlToInline(data,this.component.blacklist));this.executeEditingCommand("insertHTML",html)}else{data=clipboard.getData("text/plain").replace(/\n/g,"<br>").replace(/\s{2}/g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;");var htmlData='<div style="';htmlData+=this.bold?"font-weight: bold;":"";htmlData+=this.italic?"font-style: italic;":"";htmlData+=this.underline?"text-decoration: underline"+(this.strike?" line-through":"")+";":this.strike?"text-decoration: line-through":"";htmlData+='">'+data+"</div>";var html=inlineToHTML(htmlToInline(htmlData,this.component.blacklist));if(html){this.executeEditingCommand("insertHTML",html)}}}},{key:"keydown",value:function keydown(e){if(keyChecker(e.ctrlKey&&e.which==66,e.metaKey&&e.which==66)){this.element.find("span.bold:visible").click();e.preventDefault();return false}if(keyChecker(e.ctrlKey&&e.which==73,e.metaKey&&e.which==73)){this.element.find("span.italic:visible").click();e.preventDefault();return false}if(keyChecker(e.ctrlKey&&e.which==85,e.metaKey&&e.which==85)){this.element.find("span.underline:visible").click();e.preventDefault();return false}if(keyChecker(e.ctrlKey&&e.which==75,e.metaKey&&e.which==75)){this.element.find("span.link:visible").click();e.preventDefault();return false}}},{key:"discardChanges",value:function discardChanges(){if(!this.component){return false}this.component.discard()}},{key:"commitChanges",value:function commitChanges(){if(!this.component){return false}this.component.commit()}},{key:"onModifierClick",value:function onModifierClick(e){if(!this.component){return false}var self=this;var elem=$(e.currentTarget);if(elem.hasClass("bold")){dealWith("bold")}else if(elem.hasClass("italic")){dealWith("italic")}else if(elem.hasClass("strike")){dealWith("strikeThrough")}else if(elem.hasClass("underline")){dealWith("underline")}else if(elem.hasClass("link")){this.openLinkDialog()}else if(elem.hasClass("clear-styles")){this.executeEditingCommand("removeFormat");this.executeEditingCommand("unlink");this.element.find(".active").each(function(){if(self[this.dataset.id]){self[this.dataset.id]=false}}).removeClass("active")}function dealWith(prop){var arg=arguments.length<=1||arguments[1]===undefined?null:arguments[1];self[prop]=!self[prop];elem.toggleClass("active",self[prop]);self.executeEditingCommand(prop,arg)}this.component.element.focus()}},{key:"executeEditingCommand",value:function executeEditingCommand(command){var arg=arguments.length<=1||arguments[1]===undefined?null:arguments[1];app.canvas.iframeDoc[0].execCommand(command,false,arg)}},{key:"queryEditingCommandState",value:function queryEditingCommandState(command){return app.canvas.iframeDoc[0].queryCommandState(command)}},{key:"setDefault",value:function setDefault(){this.bold=false;this.italic=false;this.strike=false;this.underline=false;this.link=false}},{key:"openLinkDialog",value:function openLinkDialog(){var self=this;app.linkDialog.open({link:this.link,onSave:function onSave(href){href=href.trim();self.link=false;if(href){self.link=href;self.executeEditingCommand("createLink",href)}else{self.executeEditingCommand("unlink")}self.update()},onClose:function onClose(){}})}},{key:"hide",value:function hide(){_get(Object.getPrototypeOf(InlineEditingBar.prototype),"hide",this).call(this);if(app.characterInputDialog.isVisible()){app.characterInputDialog.close()}}},{key:"update",value:function update(){this.element.find(".bold").css("display","inline-block").toggleClass("active",this.bold);this.element.find(".italic").css("display","inline-block").toggleClass("active",this.italic);this.element.find(".strike").css("display","inline-block").toggleClass("active",this.strike);this.element.find(".underline").css("display","inline-block").toggleClass("active",this.underline);this.element.find(".link").css("display","inline-block").toggleClass("active",!!this.link);var blacklist=this.component.blacklist;for(var i=0;i<blacklist.length;i++){this.element.find("."+blacklist[i]).hide()}return _get(Object.getPrototypeOf(InlineEditingBar.prototype),"update",this).call(this)}}]);return InlineEditingBar}(SubBar);module.exports=InlineEditingBar},{"../helpers/htmlToInline":579,"../helpers/inlineToHTML":582,"../helpers/keyChecker":586,"./SubBar":6,"deep-equal":971}]
});
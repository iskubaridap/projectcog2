define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Bar=require("./Bar");var tabHandler=require("../helpers/tabHandler");var isContextClick=require("../helpers/isContextClick");var TabBar=function(_Bar){_inherits(TabBar,_Bar);function TabBar(elem){_classCallCheck(this,TabBar);_get(Object.getPrototypeOf(TabBar.prototype),"constructor",this).call(this);this.element=elem;this.tabHolder=elem.find(".tab-holder");this.domToContext=new WeakMap;tabHandler({app:app,tabAreas:[elem],onClick:this.onTabClick.bind(this),onChange:this.afterTabReorder.bind(this)});app.on("context-opened context-closed context-activated context-saved",this.scheduleUpdate.bind(this));app.on("context-changed",this.contextChanged.bind(this))}_createClass(TabBar,[{key:"contextChanged",value:function contextChanged(context){var index=app.openedContexts.indexOf(context);var tab=this.tabHolder.find(".tab").eq(index);tab.toggleClass("unsaved",!context.isSaved());tab.find(".title").text(formatContextName(context.name))}},{key:"onTabClick",value:function onTabClick(e){var context=this.domToContext.get(e.target.closest(".tab"));if(!context)return;var focused=app.context.page.getFocusedComponent();if(focused&&focused.isInlineEditingActivated){focused.commit();return}if(isContextClick(e)){app.contextMenu.show(e.pageX,e.pageY,[{name:"Duplicate",action:app.openDuplicateDesign.bind(app,context)},{name:"Close",action:app.confirmCloseContext.bind(app,context)}]);e.stopPropagation();return}if(e.button==1){app.confirmCloseContext(context);return}if(e.target.matches(".close")){app.confirmCloseContext(context);return}if(!context.isActive()){$(e.target).closest(".tab").addClass("active").siblings().removeClass("active");setTimeout(function(){app.activateContext(context)},5)}}},{key:"afterTabReorder",value:function afterTabReorder(){var self=this;app.openedContexts=this.element.find(".tab").map(function(){return self.domToContext.get(this)}).toArray()}},{key:"scheduleUpdate",value:function scheduleUpdate(){clearTimeout(this.timeout);this.timeout=setTimeout(this.update.bind(this),25)}},{key:"update",value:function update(){var arr=[];for(var i=0;i<app.openedContexts.length;i++){var ctx=app.openedContexts[i];var tmp=$('<div class="tab"><span class="title"></span><span class="close"></span></div>')
;tmp.find(".title").text(formatContextName(ctx.name)).attr("title",ctx.path);tmp.toggleClass("active",ctx.isActive());tmp.toggleClass("unsaved",!ctx.isSaved());this.domToContext.set(tmp[0],ctx);arr.push(tmp)}if(arr.length){this.element.show();this.tabHolder.html(arr)}}}]);return TabBar}(Bar);function formatContextName(str){if(str.length>=30){return str.slice(0,30)+".."}return str}module.exports=TabBar},{"../helpers/isContextClick":584,"../helpers/tabHandler":618,"./Bar":1}]
});
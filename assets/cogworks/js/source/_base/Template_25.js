define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var parseCogDesignFormat=require("../helpers/parseCogDesignFormat");var parseCogComponentFormat=require("../helpers/parseCogComponentFormat");var recursiveLoop=require("../helpers/recursiveLoop");var Template=function(){function Template(folder){_classCallCheck(this,Template);this.paths={template:folder+"/template.json",pagePreviews:folder+"/images/pages",widgetPreviews:folder+"/images/widgets"}}_createClass(Template,[{key:"initialize",value:function initialize(){}},{key:"initializeNavigation",value:function initializeNavigation(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.context.pages.getAll()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var page=_step.value;page.emptyMainNavbar()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"hasWidgets",value:function hasWidgets(){return!!app.template.widgets.length}},{key:"insertInto",value:function insertInto(context){var _this=this;var paths=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var options=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var ops=[];var navOps=[];var linkOps=[];var brandAdded=false;var _paths$pagePaths=paths.pagePaths;var pagePaths=_paths$pagePaths===undefined?[]:_paths$pagePaths;var _paths$navPaths=paths.navPaths;var navPaths=_paths$navPaths===undefined?[]:_paths$navPaths;var pages=this.context.getPagesByPath(pagePaths).clone();var navPages=pages.getAll().filter(function(p){return navPaths.includes(pages.getRelativePathForItem(p))});navPages.sort(function(a,b){var page1=_this.meta.pages.find(function(p){return p.path===pages.getRelativePathForItem(a)});var page2=_this.meta.pages.find(function(p){return p.path===pages.getRelativePathForItem(b)});return page1.weight-page2.weight||page1.name.localeCompare(page2.name)});ops.push(context.addPagesOp(pages));return{pages:pages.getAll(),op:{do:function _do(){var pageWithNavbar=context.findPageWithMainNavbar();ops.forEach(function(op){return op["do"]()});if(!navOps.length&&navPaths.length){if(context.exists()&&pageWithNavbar){navOps.push(pageWithNavbar.addPagesToNavigationOp(navPages))}else{var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=pages.getAll()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var page=_step2.value;if(page.hasMainNavbar()){navOps.push(page.addPagesToNavigationOp(navPages))}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}if(pageWithNavbar){pageWithNavbar.getMainNavbar().recordChangesForUpdate()}navOps.forEach(function(op){return op["do"]()});if(context.placeholders.brand&&!brandAdded){pages.getAll().forEach(function(p){p.properties.title=p.properties.title?p.properties.title.trim()+" - "+context.placeholders.brand:context.placeholders.brand});brandAdded=true}if(context.exists()){if(pageWithNavbar){pageWithNavbar.getMainNavbar().update()}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=pages.getAll()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var page=_step3.value;context.syncNewLinkedComponents(page)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}context.removeInactiveLinks()},undo:function undo(){pages.getAll().forEach(function(page){return page.html.body.softUnlinkAll()});navOps.forEach(function(op){return op.undo()});ops.forEach(function(op){return op.undo()});var pageWithNavbar=context.findPageWithMainNavbar();if(context.exists()&&pageWithNavbar){pageWithNavbar.getMainNavbar().update()}}}}}},{key:"serialize",value:function serialize(){return{meta:this.meta,images:this.images,widgets:this.widgets,context:this.context}}},{key:"unserializeWidgets",value:function unserializeWidgets(widgets){var imageList=this.images;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=widgets[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var cat=_step4.value;var group={name:cat.name,children:[]};var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=cat.children[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var pkg=_step5.value;pkg["package"].preview=imageList[pkg["package"].preview];pkg=parseCogComponentFormat(pkg);recursiveLoop(pkg.images,function(img){img.data=imageList[img.data]});group.children.push(pkg)}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}this.widgets.push(group)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}},{key:"unserialize",value:function unserialize(json){recursiveLoop(json.context.design.assets.images,function(img){img.data=json.images[img.data]});this.meta=json.meta;this.images=json.images;this.widgets=[];this.unserializeWidgets(json.widgets);this.context=parseCogDesignFormat(json.context);this.mainNavbarID=json.mainNavbarID;this.defaultNavPages=json.defaultNavPages}}]);return Template}();module.exports=Template},{"../helpers/parseCogComponentFormat":591,"../helpers/parseCogDesignFormat":592,"../helpers/recursiveLoop":602}]
});
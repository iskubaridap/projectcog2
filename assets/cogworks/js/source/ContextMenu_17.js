define([],function(){
	return [function(require,module,exports){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ContextMenu=function(){function ContextMenu(el){_classCallCheck(this,ContextMenu);this.element=el;this.visible=false;this.element.hide();this.index=0;this.menu=null;app.on("resize blur context-changed",this.hide.bind(this));app.on("scroll",this.scrolled.bind(this))}_createClass(ContextMenu,[{key:"scrolled",value:function scrolled(e){if(!this.visible)return;var closest=e.target.closest("#context-menu .menu");if(!closest){this.hide()}}},{key:"getMenuIndex",value:function getMenuIndex(){return++this.index}},{key:"show",value:function show(x,y,options){var props=arguments.length<=3||arguments[3]===undefined?{}:arguments[3];if(!options.length)return false;if(this.visible){var shouldntOpen=this.toggler&&this.toggler.is(props.toggler);this.hide();if(shouldntOpen)return}this.visible=true;this.toggler=props.toggler||null;if(this.toggler){this.toggler.addClass("context-menu-toggler open")}this.element.show();this.menu=new Menu(x,y,options,_extends({},props,{nudge:true}));this.menu.setRoot(this);this.menu.setParent(this);this.menu.show();this.activeMenu=this.menu;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=options[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var opt=_step.value;var name=typeof opt.name==="function"?opt.name():opt.name;if(opt.selected&&opt.selected(name)){this.menu.optionToDOM.get(opt).scrollIntoViewIfNeeded()}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}app.trigger("context-menu-show",this)}},{key:"hide",value:function hide(){if(!this.visible)return;if(this.toggler){this.toggler.removeClass("context-menu-toggler open");this.toggler=null}this.visible=false;this.element.hide().empty();this.menu.hide();this.menu=null;this.activeMenu=null;app.trigger("context-menu-hide",this)}},{key:"update",value:function update(){this.menu.update()}}]);return ContextMenu}();var Menu=function(){function Menu(x,y,options){var props=arguments.length<=3||arguments[3]===undefined?{}:arguments[3];_classCallCheck(this,Menu);this.x=x;this.y=y;this.options=options;this.activeOption=null;this.activeOptionIndex=-1;this.gravity=props.gravity||"right";this.coordinates=props.coordinates||{left:this.x,right:this.x};this.nudge=this.gravity==="left"?false:props.nudge;this.theme=props.theme||"light";this.multiline=!!props.multiline;this.width=props.width||null;this.onHide=props.onHide||null;this.root=null;this.parent=null;this.menu=null;this.menuShowTimer=null;this.isHoverEnabled=false;this.autoHideTimer=null;this.domToOption=new WeakMap;this.optionToDOM=new WeakMap;this.element=$('<div class="menu">');this.element.on("click",".option",this.optionClick.bind(this));this.element.on("mouseenter",".option",this.optionMouseenter.bind(this));this.element.on("mouseleave",".option",this.optionMouseleave.bind(this));this.element.on("mouseleave",this.menuMouseleave.bind(this));this.element.on("scroll",this.onScroll.bind(this))}_createClass(Menu,[{key:"setRoot",value:function setRoot(obj){this.root=obj}},{key:"setParent",value:function setParent(parent){this.parent=parent}},{key:"getMaxRight",value:function getMaxRight(){return this.gravity==="left"?this.x:win.width()}},{key:"setActiveOption",value:function setActiveOption(option){var _this=this;var node=this.optionToDOM.get(option);this.activeOption=option;this.options.map(function(opt,index){if(opt===option){opt.active=true;_this.activeOptionIndex=index}else{opt.active=false}});this.root.activeMenu=this;this.afterOptionChange(option);this.update()}},{key:"resetActiveOption",value:function resetActiveOption(){if(!this.hasActiveOption())return;if(this.menu){this.cancelSubmenuShow();this.resetSubmenu()}this.options[this.activeOptionIndex].active=false;this.activeOption=null;this.activeOptionIndex=-1;this.root.activeMenu=this.isSubmenu()?this.parent:this;this.update()}},{key:"selectOption",value:function selectOption(){if(!this.hasActiveOption())return;$(this.activeOptionNode).trigger("click")}},{key:"hasActiveOption",value:function hasActiveOption(){return this.activeOptionIndex!==-1}},{key:"isOptionDisabled",value:function isOptionDisabled(option){return typeof option.disabled==="function"?option.disabled():option.disabled}},{key:"optionCanBeHighlighted",value:function optionCanBeHighlighted(option){return(!option.type||option.type!=="heading"&&option.type!=="divider")&&!this.isOptionDisabled(option)}},{key:"getHighlightableOptions",value:function getHighlightableOptions(){var _this2=this;return this.options.filter(function(opt){return _this2.optionCanBeHighlighted(opt)}).map(function(opt){return _this2.options.indexOf(opt)})}},{key:"show",value:function show(){var zIndex=this.root.getMenuIndex();this.element.css("z-index",zIndex);var activeOption=this.options.filter(function(opt){return opt.active}).pop();if(activeOption){this.setActiveOption(activeOption)}else{this.update()}}},{key:"hide",value:function hide(){if(this.onHide){this.onHide()}}},{key:"cancelSubmenuShow",value:function cancelSubmenuShow(){clearTimeout(this.menuShowTimer)}},{key:"clearSubmenu",value:function clearSubmenu(){this.cancelSubmenuShow();if(!this.menu)return;this.menu.element.remove();this.menu.clearSubmenu()}},{key:"resetSubmenu",value:function resetSubmenu(){if(!this.menu)return;this.clearSubmenu();this.menu=null;this.menuShowTimer=null}},{key:"setSubmenu",value:function setSubmenu(option){var node=this.optionToDOM.get(option);var rect=node.getBoundingClientRect();this.menu=new Menu(this.gravity==="left"?rect.left:rect.right,rect.top,$.extend(true,[],option.options),{theme:this.theme,gravity:this.gravity,coordinates:{left:rect.left+10,right:rect.right-10}});this.menu.setRoot(this.root);this.menu.setParent(this)}},{key:"showSubmenu",value:function showSubmenu(){if(!this.hasActiveOption())return;this.setSubmenu(this.activeOption);this.menu.show()}},{key:"next",value:function next(){
this.isHoverEnabled=false;this.moveFocus(1)}},{key:"prev",value:function prev(){this.isHoverEnabled=false;this.moveFocus(-1)}},{key:"focusSubmenu",value:function focusSubmenu(){if(!this.menu)return;this.menu.next()}},{key:"focusParent",value:function focusParent(){if(!this.isSubmenu())return;this.resetActiveOption()}},{key:"isActiveMenu",value:function isActiveMenu(){return this===this.root.activeMenu}},{key:"isMainMenu",value:function isMainMenu(){return this.parent instanceof ContextMenu}},{key:"isSubmenu",value:function isSubmenu(){return this.parent&&this.parent instanceof Menu}},{key:"calcCoordinates",value:function calcCoordinates(){var maxRight=this.getMaxRight();if(this.gravity==="left"){if(this.x-this.element.width()<0){this.gravity="right";this.x=this.coordinates.left;maxRight=this.getMaxRight();if(this.coordinates.right+this.element.width()<=maxRight){this.x=this.coordinates.right}}}else{if(this.x+this.element.width()>maxRight){this.gravity="left";this.x=this.nudge?maxRight:this.coordinates.right;maxRight=this.getMaxRight();if(this.coordinates.left-this.element.width()>=0){this.x=this.nudge?maxRight:this.coordinates.left}}}}},{key:"moveFocus",value:function moveFocus(direction){var highlightableOptions=this.getHighlightableOptions();if(!highlightableOptions.length)return;var option;var activeIndex=this.activeOptionIndex;var newIndex=highlightableOptions.indexOf(activeIndex)+direction;if(newIndex>highlightableOptions.length-1){newIndex=0}else if(newIndex<0){newIndex=highlightableOptions.length-1}activeIndex=highlightableOptions[newIndex];option=this.options[activeIndex];this.setActiveOption(option)}},{key:"afterOptionChange",value:function afterOptionChange(option){if(!option)return;if(this.menu){this.resetSubmenu()}this.cancelSubmenuShow();if(!option.options)return;this.menuShowTimer=setTimeout(function(){this.showSubmenu()}.bind(this),250)}},{key:"optionMouseenter",value:function optionMouseenter(e){var node=e.target.closest(".option");var option=this.domToOption.get(node);this.isHoverEnabled=true;if(this.hasActiveOption()&&option===this.activeOption&&this.isActiveMenu()){return}if(this.menu&&this.menu.isActiveMenu()&&option===this.activeOption){this.menu.focusParent()}else{this.setActiveOption(option)}}},{key:"optionMouseleave",value:function optionMouseleave(e){if(e.relatedTarget===null||e.relatedTarget&&e.relatedTarget.matches(".menu")){this.isHoverEnabled=false;this.update()}}},{key:"onScroll",value:function onScroll(e){if(this.menu){this.resetSubmenu()}}},{key:"isOption",value:function isOption(target){return!!this.domToOption.get(target)}},{key:"optionClick",value:function optionClick(e){if(e.target.tagName=="INPUT"){return}var node=e.target.closest(".option");var option=this.domToOption.get(node);if(!option||!option.action)return;var result;var shouldUpdate=false;if(this.isOptionDisabled(option))return;if(option.checkbox){var checked=!$(node).find("input").prop("checked");result=option.action(e,checked);this.activeOption.checkboxChecked=checked;shouldUpdate=true}else if(option.selected){if(!option.selected(option.name)){result=option.action(e);shouldUpdate=true}else{result=false}}else{result=option.action(e)}if(result!==false){this.root.hide()}else{if(shouldUpdate){this.forceUpdate()}}}},{key:"menuMouseleave",value:function menuMouseleave(){if(this.isSubmenu()||this.menu)return;this.resetActiveOption()}},{key:"forceUpdate",value:function forceUpdate(){this.isHoverEnabled=false;this.update()}},{key:"update",value:function update(){this.element.toggleClass("hover-enabled",this.isHoverEnabled);if(this.isHoverEnabled)return;var scrollTop=this.element.scrollTop();this.element.empty();if(this.width){this.element.width(this.width)}if(this.multiline){this.element.addClass("multiline")}this.element.addClass(this.theme);this.element.html(this.renderOptions()).appendTo(this.root.element);this.element.scrollTop(scrollTop);if(this.activeOption){this.activeOptionNode.scrollIntoViewIfNeeded()}this.calcCoordinates();if(this.gravity==="left"){this.element.css({right:win.width()-this.x,left:"auto"})}else{this.element.css({left:this.x,right:"auto"})}if(this.y+this.element.height()>win.height()){this.element.css({bottom:win.height()-this.y,top:"auto"})}else{this.element.css({top:this.y,bottom:"auto"})}if(this.menu){this.menu.update()}}},{key:"renderOptions",value:function renderOptions(){var fragment=document.createDocumentFragment();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.options[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var opt=_step2.value;var node=this.renderOption(opt);if(node){fragment.appendChild(node)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return fragment}},{key:"renderOption",value:function renderOption(opt){if(opt.visible&&!opt.visible())return;if(opt.type==="divider"){var divider=document.createElement("span");divider.className="divider";return divider}var name=typeof opt.name==="function"?opt.name():opt.name;if(opt.type==="heading"){var heading=document.createElement("span");heading.className="heading";if(this.multiline){heading.textContent=name}else{if(name.length<40){heading.textContent=name}else{heading.textContent=name.slice(0,40)+"..";heading.title=name}}return heading}var node=document.createElement("span");if(opt.checkbox){node=document.createElement("label")}node.className=opt.active?"option active":"option";if(this.multiline){node.textContent=name}else{if(name.length<40){node.textContent=name}else{node.textContent=name.slice(0,40)+"..";node.title=name}}if(opt.title){node.title=opt.title}if(opt.icon){var icon=document.createElement("i");icon.className="material-icons icon";icon.textContent=opt.icon;node.classList.add("has-icon");node.appendChild(icon)}if(opt.selected){node.classList.add("selected");if(opt.selected(name)){var selected=document.createElement("i");selected.className="material-icons selection-icon";selected.textContent="check_circle";node.appendChild(selected)}}if(opt.style){node.setAttribute("style",opt.style)}if(opt.secondary){var secondary=document.createElement("span");secondary.className="secondary";secondary.textContent=opt.secondary;node.appendChild(secondary)}if(opt.label){var label=document.createElement("span");label.className="label";label.textContent=opt.label;node.appendChild(label)}if(opt.checkbox){var checkbox=document.createElement("b");checkbox.className="pretty-checkbox "+this.theme;checkbox.innerHTML='<input type="checkbox" /><i></i>';if(opt.checkboxChecked){$(checkbox).find("input").prop("checked",true)}node.classList.add("checkbox");node.appendChild(checkbox)}if(this.isOptionDisabled(opt)){node.classList.add("disabled")}this.domToOption.set(node,opt);this.optionToDOM.set(opt,node);if(Array.isArray(opt.options)){node.classList.add("has-options");if(!opt.options.length){node.classList.add("disabled")}}return node}},{key:"activeOptionNode",get:function get(){return this.optionToDOM.get(this.activeOption)}}]);return Menu}();module.exports=ContextMenu},{}]
});
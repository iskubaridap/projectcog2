define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x3,_x4,_x5){var _again=true;_function:while(_again){var object=_x3,property=_x4,receiver=_x5;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x3=parent;_x4=property;_x5=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Editor=require("./Editor");require("codemirror/mode/javascript/javascript");require("codemirror/mode/htmlmixed/htmlmixed");require("codemirror/addon/comment/comment");require("codemirror/addon/edit/closebrackets");require("codemirror/addon/edit/matchbrackets");require("codemirror/addon/selection/active-line");require("codemirror/addon/dialog/dialog");require("codemirror/addon/search/searchcursor");require("codemirror/addon/search/search");require("codemirror/keymap/sublime");require("codemirror/addon/fold/foldcode");require("codemirror/addon/fold/foldgutter");require("codemirror/addon/fold/comment-fold");require("codemirror/addon/fold/brace-fold");require("codemirror/addon/fold/xml-fold");var CodeMirror=require("codemirror");var CodeEditor=function(_Editor){_inherits(CodeEditor,_Editor);function CodeEditor(target,mode){var _extraKeys;var historyTitle=arguments.length<=2||arguments[2]===undefined?"Code Edited":arguments[2];_classCallCheck(this,CodeEditor);_get(Object.getPrototypeOf(CodeEditor.prototype),"constructor",this).call(this);this.mode=mode;this.target=target;this.historyTitle=historyTitle;this.element=$('\n\t\t\t<div class="code-editor editor">\n\t\t\t\t<div class="toolbar">\n\t\t\t\t\t<a class="button darkgray save">Apply</a>\n\t\t\t\t\t<a class="button darkgray search icon" title="Search"><i class="material-icons">search</i></a>\n\t\t\t\t\t<a class="button darkgray replace icon" title="Replace"><i class="material-icons">find_replace</i></a>\n\t\t\t\t\t<a class="button settings icon">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="content"></div>\n\t\t\t</div>\n\t\t');this.originalValue=target.value;this.historyAffectedButtonGroup=this.element.find(".save");this.editorFocused=false;this.widgets=[];var that=this;var options=Object.assign({},{value:target.value,mode:mode,lineNumbers:true,lineWrapping:true,tabSize:4,indentUnit:4,inputStyle:"contenteditable",styleActiveLine:true,matchBrackets:true,autoCloseBrackets:true,keyMap:"sublime",addModeClass:true,dragDrop:false,foldGutter:true,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:(_extraKeys={},_defineProperty(_extraKeys,electron.os=="osx"?"Cmd-S":"Ctrl-S",function(cm){that.save();app.saveDesign(app.context)}),_defineProperty(_extraKeys,electron.os=="osx"?"Cmd-Enter":"Ctrl-Enter",function(cm){that.save()}),_extraKeys),theme:"bstudio"},getEditorSettings());this.codeMirror=CodeMirror(function(cm){that.element.find(".content").append(cm)},options);this.codeMirror.addKeyMap({Tab:function Tab(cm){if(cm.somethingSelected()){cm.execCommand("indentMore");return}if(cm.getOption("indentWithTabs")){cm.execCommand("insertTab")}else{cm.execCommand("insertSoftTab")}},"Shift-Tab":function ShiftTab(cm){cm.execCommand("indentLess")}});this.changeGeneration=this.codeMirror.doc.changeGeneration();this.settingsMenuOpen=false;this.lastHasChangeStatus=false;this.panelResizeListener=this.panelResized.bind(this)}_createClass(CodeEditor,[{key:"destructor",value:function destructor(){}},{key:"bindEventListeners",value:function bindEventListeners(){_get(Object.getPrototypeOf(CodeEditor.prototype),"bindEventListeners",this).call(this);this.element.on("click",".save",this.saveButtonClick.bind(this));this.element.on("click",".search",this.searchButtonClick.bind(this));this.element.on("click",".replace",this.replaceButtonClick.bind(this));this.element.on("click",".settings",this.settingsButtonClick.bind(this));this.element.on("blur","[contenteditable]",function(){win[0].getSelection().removeAllRanges()});this.codeMirror.on("changes",this.editorChanges.bind(this));this.codeMirror.on("renderLine",this.renderLine.bind(this));this.codeMirror.on("fold",this.foldChange.bind(this));this.codeMirror.on("unfold",this.foldChange.bind(this));app.on("panel-resize",this.panelResizeListener)}},{key:"unbindEventListeners",value:function unbindEventListeners(){_get(Object.getPrototypeOf(CodeEditor.prototype),"unbindEventListeners",this).call(this);this.element.off();this.codeMirror.off("changes");this.codeMirror.off("renderLine");this.codeMirror.off("fold");this.codeMirror.off("unfold");app.off("panel-resize",this.panelResizeListener)}},{key:"getName",value:function getName(){return this.target.name}},{key:"editorChanges",value:function editorChanges(){if(this.lastHasChangeStatus!=this.hasChanges()){this.lastHasChangeStatus=this.hasChanges();app.editorPanel.updateTabForEditor(this);this.removeAllWidgets();this.update()}}},{key:"setCursor",value:function setCursor(line){var col=arguments.length<=1||arguments[1]===undefined?0:arguments[1];this.codeMirror.doc.setCursor(line,col)}},{key:"renderLine",value:function renderLine(cm,line,element){var charWidth=cm.defaultCharWidth();var basePadding=cm.getOption("indentUnit");var off=CodeMirror.countColumn(line.text,null,cm.getOption("tabSize"))*charWidth;element.style.textIndent="-"+off+"px";element.style.paddingLeft=basePadding+off+"px"}},{key:"foldChange",value:function foldChange(){this.removeAllWidgets()}},{key:"targetUpdated",value:function targetUpdated(target){if(target!=this.target)return;this.codeMirror.doc.setValue(this.target.value);this.originalValue=this.target.value;this.codeMirror.doc.clearHistory();this.changeGeneration=this.codeMirror.doc.changeGeneration();this.lastHasChangeStatus=false;app.editorPanel.updateTabForEditor(this);this.removeAllWidgets();this.update()}},{key:"saveButtonClick",value:function saveButtonClick(){this.save()}},{key:"searchButtonClick",value:function searchButtonClick(){this.codeMirror.execCommand("find")}},{key:"replaceButtonClick",value:function replaceButtonClick(){this.codeMirror.execCommand("replace")}},{key:"settingsButtonClick",value:function settingsButtonClick(e){var _this=this;var target=$(e.target.closest(".settings"));var options=[];var tabSizes=[2,4,8];var tabSizeOptions=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=tabSizes[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var size=_step.value;tabSizeOptions.push({name:size.toString(),action:changeTabSize.bind(this,e,size),selected:function selected(size){return _this.codeMirror.getOption("tabSize")==size}})}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}options.push({name:"Wrap Text",action:function(e,value){this.changeSetting("lineWrapping",value);return false}.bind(this),checkbox:true,checkboxChecked:this.codeMirror.getOption("lineWrapping")},{name:"Use Tabs",action:function(e,value){this.changeSetting("indentWithTabs",value);return false}.bind(this),checkbox:true,checkboxChecked:this.codeMirror.getOption("indentWithTabs")},{name:"Tab Size",options:tabSizeOptions});var rect=target[0].getBoundingClientRect();app.contextMenu.show(rect.right+10,rect.bottom+10,options,{toggler:target,gravity:"left"});function changeTabSize(e,tabSize){this.changeSetting("tabSize",tabSize);this.changeSetting("indentUnit",tabSize);this.codeMirror.refresh();return false}}},{key:"changeSetting",value:function changeSetting(setting,value){this.codeMirror.setOption(setting,value);saveEditorSetting(setting,this.codeMirror.getOption(setting))}},{key:"toggleTextWrap",value:function toggleTextWrap(){this.codeMirror.setOption("lineWrapping",!this.codeMirror.getOption("lineWrapping"))}},{key:"panelResized",value:function panelResized(){this.codeMirror.refresh()}},{key:"hasChanges",value:function hasChanges(){return this.changeGeneration!=this.codeMirror.doc.changeGeneration()}},{key:"isSaved",value:function isSaved(){return!this.hasChanges()}},{key:"save",value:function save(){if(!this.hasChanges())return false;this.changeGeneration=this.codeMirror.doc.changeGeneration();app.editorPanel.updateTabForEditor(this);this.update();var that=this;setTimeout(function(){that.codeMirror.focus()},20);return true}},{key:"activate",value:function activate(){_get(Object.getPrototypeOf(CodeEditor.prototype),"activate",this).call(this);var that=this;setTimeout(function(){that.codeMirror.focus();that.codeMirror.refresh()},20)}},{key:"showError",value:function showError(line,message){if(line>this.codeMirror.lineCount()){return}var node=document.createElement("div");node.className="editor-error";node.title=message;this.addWidget(line,node);node.style.transform="translateX(-"+(30+(line.toString().length-1)*3)+"px)"}},{key:"addWidget",value:function addWidget(line,elem){this.widgets.push(elem);this.codeMirror.addWidget({line:line,ch:0},elem,false,"over","left")}},{key:"removeAllWidgets",value:function removeAllWidgets(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.widgets[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var widget=_step2.value;widget.parentNode.removeChild(widget)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.widgets.length=0}},{key:"update",value:function update(){this.historyAffectedButtonGroup.toggleClass("active",this.hasChanges());return this.element}}]);return CodeEditor}(Editor);module.exports=CodeEditor;function getEditorSettings(){return electron.readSetting("editorSettings",{})}function saveEditorSetting(id,value){var settings=getEditorSettings();settings[id]=value;electron.saveSetting("editorSettings",settings)}},{"./Editor":532,"codemirror":753,"codemirror/addon/comment/comment":740,"codemirror/addon/dialog/dialog":741,"codemirror/addon/edit/closebrackets":742,"codemirror/addon/edit/matchbrackets":743,"codemirror/addon/fold/brace-fold":744,"codemirror/addon/fold/comment-fold":745,"codemirror/addon/fold/foldcode":746,"codemirror/addon/fold/foldgutter":747,"codemirror/addon/fold/xml-fold":748,"codemirror/addon/search/search":749,"codemirror/addon/search/searchcursor":750,"codemirror/addon/selection/active-line":751,"codemirror/keymap/sublime":752,"codemirror/mode/htmlmixed/htmlmixed":755,"codemirror/mode/javascript/javascript":756}]
});
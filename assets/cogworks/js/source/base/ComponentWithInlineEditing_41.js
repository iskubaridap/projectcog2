define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x3,_x4,_x5){var _again=true;_function:while(_again){var object=_x3,property=_x4,receiver=_x5;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x3=parent;_x4=property;_x5=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ComponentWithChildren=require("./ComponentWithChildren");var Component=require("./Component");var InlineCharacter=require("./InlineCharacter");var inlineToHTML=require("../../helpers/inlineToHTML");var inlineToDOM=require("../../helpers/inlineToDOM");var inlineCompare=require("../../helpers/inlineCompare");var htmlToInline=require("../../helpers/htmlToInline");var getDimensions=require("../../helpers/getDimensions");var canParentTakeChildren=require("../../helpers/canParentTakeChildren");var getElementTextNodes=require("../../helpers/getElementTextNodes");var getElementNodes=require("../../helpers/getElementNodes");var InlineEditingBar=require("../../bars/InlineEditingBar");var keyChecker=require("../../helpers/keyChecker");var clone=require("clone");var blacklistMap={bold:66,link:75,italic:73};var ComponentWithInlineEditing=function(_ComponentWithChildren){_inherits(ComponentWithInlineEditing,_ComponentWithChildren);function ComponentWithInlineEditing(content){_classCallCheck(this,ComponentWithInlineEditing);_get(Object.getPrototypeOf(ComponentWithInlineEditing.prototype),"constructor",this).call(this);if(content){this.children=htmlToInline(content)}this.element=$();this.flags.canBeEdited=true;this.isInlineEditingActivated=false;this._numberOfClicks=1;this._lastClickedCharIndex=0;this.blacklist=[];var that=this;this.defineActions({label:"Edit",icon:"edit",visible:function visible(){return that.flags.canBeEdited},action:this.activateInlineEditingAndMoveCaretToEnd.bind(this),showInFocusBar:true,showInContextMenu:true,showInApplicationMenu:true,weight:1});this.inlineEditingBar=null}_createClass(ComponentWithInlineEditing,[{key:"initialize",value:function initialize(){var str=arguments.length<=0||arguments[0]===undefined?"Text":arguments[0];this.children=htmlToInline(str)}},{key:"setContent",value:function setContent(str){this.children=htmlToInline(str)}},{key:"getContent",value:function getContent(content){return inlineToHTML(this.children)}},{key:"duplicateAction",value:function duplicateAction(){if(this.isInlineEditingActivated){return false}_get(Object.getPrototypeOf(ComponentWithInlineEditing.prototype),"duplicateAction",this).call(this)}},{key:"cleanup",value:function cleanup(){Component.prototype.cleanup.call(this);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;if(!(child instanceof InlineCharacter)){child.cleanup()}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return this}},{key:"stripImagePaths",value:function stripImagePaths(imagePaths){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var child=_step2.value;if(!(child instanceof InlineCharacter)){child.stripImagePaths(imagePaths)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"childNeedsDimensionUpdate",value:function childNeedsDimensionUpdate(){for(var i=0;i<this.children.length;i++){if(this.children[i]instanceof InlineCharacter){if(this.children[i].needsDimensionUpdate){return true}}}return false}},{key:"getTextNodes",value:function getTextNodes(){var _this=this;return getElementTextNodes(this.element[0],function(elem){return _this.page().findComponentForElement(elem)==_this})}},{key:"getBRNodes",value:function getBRNodes(){var _this2=this;return getElementNodes(this.element[0],"BR",function(elem){return _this2.page().findComponentForElement(elem)==_this2})}},{key:"updateInlineCharacterDimensions",value:function updateInlineCharacterDimensions(){var nodes=this.getTextNodes();var brNodes=this.getBRNodes();var rect=null;var index=0;var range=document.createRange();var children=this.getInlineCharacterChildren();var regularChars=[];var brs=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=children[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var child=_step3.value;if(child.isRegular()){regularChars.push(child)}else if(child.isBR()){brs.push(child)}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=nodes[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var node=_step4.value;for(var i=0;i<node.length;i++){range.setStart(node,i);range.setEnd(node,i+1);rect=getDimensions(range);regularChars[index+i].updateDimensions(rect.left,rect.top,rect.width,rect.height);regularChars[index+i].needsDimensionUpdate=false}index+=node.length}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=brNodes[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var node=_step5.value;var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=brs[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var br=_step6.value;if(br.domNode==node){rect=node.getBoundingClientRect();br.updateDimensions(rect.left,rect.top,rect.width,rect.height);break}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]){_iterator6["return"]()}}finally{if(_didIteratorError6){throw _iteratorError6}}}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}},{key:"getChildAtPoint",value:function getChildAtPoint(point){var found=null;var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=this.children[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var child=_step7.value;if(point.withinRect(child.x,child.y,child.x2,child.y2)){found=child;break}}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7["return"]){_iterator7["return"]()}}finally{if(_didIteratorError7){throw _iteratorError7}}}return found}},{key:"getAllComponentChildren",value:function getAllComponentChildren(){var children=[];for(var i=0;i<this.children.length;i++){if(!(this.children[i]instanceof InlineCharacter)){children.push(this.children[i])}}return children}},{key:"getInlineCharacterChildren",value:function getInlineCharacterChildren(){var children=[];for(var i=0;i<this.children.length;i++){if(this.children[i]instanceof InlineCharacter){children.push(this.children[i])}}return children}},{key:"getBRChildren",value:function getBRChildren(){var children=[];for(var i=0;i<this.children.length;i++){if(this.children[i]instanceof InlineCharacter&&this.children[i].isBR()){children.push(this.children[i])}}return children}},{key:"findFirstComponentChild",value:function findFirstComponentChild(){for(var i=0;i<this.children.length;i++){if(!(this.children[i]instanceof InlineCharacter)){return this.children[i]}}return false}},{key:"findNextComponentChild",value:function findNextComponentChild(current){var currentIndex=this.childIndex(current);for(var i=currentIndex+1;i<this.children.length;i++){if(!(this.children[i]instanceof InlineCharacter)){return this.children[i]}}return false}},{key:"findPreviousComponentChild",value:function findPreviousComponentChild(current){var currentIndex=this.childIndex(current);for(var i=currentIndex-1;i>=0;i--){if(!(this.children[i]instanceof InlineCharacter)){return this.children[i]}}return false}},{key:"copyChildrenFrom",value:function copyChildrenFrom(other){this.children.length=0;this.children.push.apply(this.children,other.children.map(function(c){return c.clone()}))}},{key:"getAllUserClassNames",value:function getAllUserClassNames(){var classNames=Component.prototype.getAllUserClassNames.call(this);var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=this.getAllComponentChildren()[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var child=_step8.value;classNames.push.apply(classNames,_toConsumableArray(child.getAllUserClassNames()))}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally{try{if(!_iteratorNormalCompletion8&&_iterator8["return"]){_iterator8["return"]()}}finally{if(_didIteratorError8){throw _iteratorError8}}}return classNames}},{key:"replaceTemplatePlaceholders",value:function replaceTemplatePlaceholders(placeholders){for(var key in placeholders){var indexes=[];var placeholder="{"+key+"}";for(var i=0;i<this.children.length;i++){var match=false;var inlineElem=this.children[i];if(!(inlineElem instanceof InlineCharacter))continue;if(inlineElem.char===placeholder.at(0)){match=true;for(var j=1;j<placeholder.length;j++){if(i+j>=this.children.length||this.children[i+j].char!==placeholder.at(j)){match=false;break}}if(match){indexes.push(i)}}}if(indexes.length){var replacement=placeholders[key];for(var i=0;i<indexes.length;i++){var _children;indexes[i]+=i*(replacement.length-placeholder.length);(_children=this.children).splice.apply(_children,[indexes[i],placeholder.length].concat(_toConsumableArray(htmlToInline(replacement))))}}}_get(Object.getPrototypeOf(ComponentWithInlineEditing.prototype),"replaceTemplatePlaceholders",this).call(this,placeholders)}},{key:"showContextMenu",
value:function showContextMenu(){if(this.isInlineEditingActivated){return false}_get(Object.getPrototypeOf(ComponentWithInlineEditing.prototype),"showContextMenu",this).call(this)}},{key:"createToolbar",value:function createToolbar(){if(this.inlineEditingBar){return this.inlineEditingBar}return _get(Object.getPrototypeOf(ComponentWithInlineEditing.prototype),"createToolbar",this).call(this)}},{key:"isChildElementBlacklisted",value:function isChildElementBlacklisted(node){return node!=this.element[0]}},{key:"hoverDrag",value:function hoverDrag(){var offset=arguments.length<=0||arguments[0]===undefined?0:arguments[0];if(!canParentTakeChildren(this,app.draggedComponents)){return this.parent&&this.parent.hoverDrag(offset)}if(!this.isPointWithinOffset(app.canvas.mousePosition,offset)&&this.parent){return this.parent.hoverDrag(offset)}if(this.childNeedsDimensionUpdate()){this.updateInlineCharacterDimensions()}app.canvas.highlight(this);app.dropCall={object:this,method:"insertAt",arguments:null};var hovered=this.getChildAtPoint(app.canvas.mousePosition);if(!hovered){var brs=this.getBRChildren();var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=brs[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var br=_step9.value;if(app.canvas.mousePosition.y>=br.y&&app.canvas.mousePosition.y<=br.y2){hovered=br;break}}}catch(err){_didIteratorError9=true;_iteratorError9=err}finally{try{if(!_iteratorNormalCompletion9&&_iterator9["return"]){_iterator9["return"]()}}finally{if(_didIteratorError9){throw _iteratorError9}}}}if(hovered){var offset=0;var index=this.childIndex(hovered);var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=app.draggedComponents[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var dragged=_step10.value;var childIndex=this.childIndex(dragged);if(childIndex>-1){if(childIndex<=index){offset--}}}}catch(err){_didIteratorError10=true;_iteratorError10=err}finally{try{if(!_iteratorNormalCompletion10&&_iterator10["return"]){_iterator10["return"]()}}finally{if(_didIteratorError10){throw _iteratorError10}}}if(hovered.isPointWithin(app.canvas.mousePosition)){if(hovered.x+hovered.width/2<=app.canvas.mousePosition.x){app.dropCall.arguments=[app.draggedComponents,index+1+offset];app.canvas.drawVerticalLine(hovered.x+hovered.width,hovered.y,hovered.height)}else{app.dropCall.arguments=[app.draggedComponents,index+offset];app.canvas.drawVerticalLine(hovered.x,hovered.y,hovered.height)}}else{app.dropCall.arguments=[app.draggedComponents,index+offset];var borderLeft=hovered.x;if(hovered.x==this.x){borderLeft+=3}if(hovered.x==this.x2){borderLeft-=3}app.canvas.drawVerticalLine(borderLeft,hovered.y,hovered.height)}}else{app.dropCall.arguments=[app.draggedComponents,this.children.length+offset]}return true}},{key:"canTakeChild",value:function canTakeChild(child){return!!child.inline}},{key:"hasChild",value:function hasChild(type){for(var i=0;i<this.children.length;i++){if(this.children[i]instanceof InlineCharacter){continue}if(this.children[i]instanceof type)return true;if(this.children[i].hasChild(type))return true}return false}},{key:"onDoubleClick",value:function onDoubleClick(){if(!this.flags.canBeEdited)return false;if(!this.isInlineEditingActivated){this.activateInlineEditing()}}},{key:"onOverviewDoubleClick",value:function onOverviewDoubleClick(){var _this3=this;if(!this.flags.canBeEdited)return false;if(!this.isInlineEditingActivated){setTimeout(function(){_this3.activateInlineEditingAndMoveCaretToEnd()},10)}}},{key:"onUnselect",value:function onUnselect(){_get(Object.getPrototypeOf(ComponentWithInlineEditing.prototype),"onUnselect",this).call(this);this.commit()}},{key:"commit",value:function commit(){var _this4=this;if(!this.isInlineEditingActivated){return}this.deactivateInlineEditing();var newChildren=htmlToInline(this.element[0],this.blacklist,function(elem){var comp=_this4.page().findComponentForElement(elem);if(comp!==_this4){return comp}return null});if(!inlineCompare(this.children,newChildren)){var _children2;var oldChildren=this.children.slice();var that=this;this.children.length=0;(_children2=this.children).push.apply(_children2,_toConsumableArray(newChildren));this.update();app.context.history.add({name:"Edit Text",undo:function undo(){var _that$children;that.children.length=0;(_that$children=that.children).push.apply(_that$children,_toConsumableArray(oldChildren));that.update()},redo:function redo(){var _that$children2;that.children.length=0;(_that$children2=that.children).push.apply(_that$children2,_toConsumableArray(newChildren));that.update()}})}}},{key:"discard",value:function discard(){this.deactivateInlineEditing();this.update()}},{key:"activateInlineEditingAndEmpty",value:function activateInlineEditingAndEmpty(){this.activateInlineEditing();var selection=app.canvas.iframeWin[0].getSelection();var range=app.canvas.iframeDoc[0].createRange();range.selectNodeContents(this.element[0]);selection.removeAllRanges();selection.addRange(range);range.deleteContents()}},{key:"activateInlineEditingAndMoveCaretToEnd",value:function activateInlineEditingAndMoveCaretToEnd(){this.activateInlineEditing();var selection=app.canvas.iframeWin[0].getSelection();var range=app.canvas.iframeDoc[0].createRange();range.selectNodeContents(this.element[0]);selection.removeAllRanges();selection.addRange(range);range.collapse(false);this.element.focus()}},{key:"activateInlineEditing",value:function activateInlineEditing(){if(!this.isSelected()){this.focus()}this.isInlineEditingActivated=true;this.element.attr("contenteditable","true");var InputBase=require("./InputBase");var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=this.getAllComponentChildren()[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var comp=_step11.value;if(comp instanceof InputBase){continue}comp.element.attr("contenteditable","false")}}catch(err){_didIteratorError11=true;_iteratorError11=err}finally{try{if(!_iteratorNormalCompletion11&&_iterator11["return"]){_iterator11["return"]()}}finally{if(_didIteratorError11){throw _iteratorError11}}}app.trigger("component-inlineediting-start",this);this.inlineEditingBar=new InlineEditingBar(this);app.updateComponentToolbar();app.trigger("selectionchange")}},{key:"deactivateInlineEditing",value:function deactivateInlineEditing(){if(!this.isInlineEditingActivated)return false;this.element.removeAttr("contenteditable");var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=this.getAllComponentChildren()[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var comp=_step12.value;comp.element.removeAttr("contenteditable")}}catch(err){_didIteratorError12=true;_iteratorError12=err}finally{try{if(!_iteratorNormalCompletion12&&_iterator12["return"]){_iterator12["return"]()}}finally{if(_didIteratorError12){throw _iteratorError12}}}this.isInlineEditingActivated=false;app.trigger("component-inlineediting-end",this);this.inlineEditingBar=null;app.updateComponentToolbar()}},{key:"onKeydown",value:function onKeydown(e){if(!this.isInlineEditingActivated){if(e.which==13){this.activateInlineEditingAndMoveCaretToEnd();e.preventDefault();return false}return}if(e.which==27){this.discard()}if(e.which==13&&!e.shiftKey){e.preventDefault();this.commit()}if(e.which==32){e.preventDefault();app.canvas.iframeDoc[0].execCommand("insertText",false," ")}var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=this.blacklist[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=true){var bl=_step13.value;if(keyChecker(e.which==blacklistMap[bl]&&e.ctrlKey,e.which==blacklistMap[bl]&&e.metaKey)){e.preventDefault();return false}}}catch(err){_didIteratorError13=true;_iteratorError13=err}finally{try{if(!_iteratorNormalCompletion13&&_iterator13["return"]){_iterator13["return"]()}}finally{if(_didIteratorError13){throw _iteratorError13}}}if(keyChecker(e.which==75&&e.ctrlKey,e.which==75&&e.metaKey)){this.inlineEditingBar.openLinkDialog()}return false}},{key:"onInput",value:function onInput(e){if(!this.isInlineEditingActivated){e.preventDefault();return}this.updateDimensions()}},{key:"findUsedImages",value:function findUsedImages(){var context=this.context();var images=Component.prototype.findUsedImages.call(this);var links=new Set;var image=null;var _iteratorNormalCompletion14=true;var _didIteratorError14=false;var _iteratorError14=undefined;try{for(var _iterator14=this.children[Symbol.iterator](),_step14;!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=true){var child=_step14.value;if(child instanceof InlineCharacter){if(child.link)links.add(child.link);continue}var _iteratorNormalCompletion16=true;var _didIteratorError16=false;var _iteratorError16=undefined;try{for(var _iterator16=child.findUsedImages()[Symbol.iterator](),_step16;!(_iteratorNormalCompletion16=(_step16=_iterator16.next()).done);_iteratorNormalCompletion16=true){image=_step16.value;if(!images.includes(image)){images.push(image)}}}catch(err){_didIteratorError16=true;_iteratorError16=err}finally{try{if(!_iteratorNormalCompletion16&&_iterator16["return"]){_iterator16["return"]()}}finally{if(_didIteratorError16){throw _iteratorError16}}}}}catch(err){_didIteratorError14=true;_iteratorError14=err}finally{try{if(!_iteratorNormalCompletion14&&_iterator14["return"]){_iterator14["return"]()}}finally{if(_didIteratorError14){throw _iteratorError14}}}var _iteratorNormalCompletion15=true;var _didIteratorError15=false;var _iteratorError15=undefined;try{for(var _iterator15=links[Symbol.iterator](),_step15;!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=true){var link=_step15.value;if(image=context.assets.images.getItemByRelativePath(link)){if(!images.includes(image)){images.push(image)}}}}catch(err){_didIteratorError15=true;_iteratorError15=err}finally{try{if(!_iteratorNormalCompletion15&&_iterator15["return"]){_iterator15["return"]()}}finally{if(_didIteratorError15){throw _iteratorError15}}}return images}},{key:"startUpdate",value:function startUpdate(){for(var i=0;i<this.children.length;i++){this.children[i].update()}var context=this.context();if(context.isExport||context.isPreview||context.isScreenshot){var depth=context.pages.getItemDepth(this.page());this.element.html(context.replaceResourceURLsInHTML(inlineToHTML(this.children),depth));Component.prototype.startUpdate.call(this);return this.element}var tree=inlineToDOM(this.children);this.element.empty();this.element.append(tree);Component.prototype.startUpdate.call(this);return this.element}},{key:"updateDimensions",value:function updateDimensions(){Component.prototype.updateDimensions.call(this);for(var i=0;i<this.children.length;i++){if(this.children[i]instanceof InlineCharacter){this.children[i].needsDimensionUpdate=true}else{this.children[i].updateDimensions()}}}},{key:"serialize",value:function serialize(){var obj=Component.prototype.serialize.call(this);obj.children=[];var lastChar=null;var buffer="";var _iteratorNormalCompletion17=true;var _didIteratorError17=false;var _iteratorError17=undefined;try{for(var _iterator17=this.children[Symbol.iterator](),_step17;!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=true){var child=_step17.value;if(!(child instanceof InlineCharacter)){if(buffer){obj.children.push(buffer);buffer=""}obj.children.push(child.serialize());continue}if(lastChar&&lastChar.sameStylesAs(child)){buffer+=child.char;lastChar=child;continue}if(buffer){obj.children.push(buffer);buffer=""}obj.children.push(child.serialize());lastChar=child}}catch(err){_didIteratorError17=true;_iteratorError17=err}finally{try{if(!_iteratorNormalCompletion17&&_iterator17["return"]){_iterator17["return"]()}}finally{if(_didIteratorError17){throw _iteratorError17}}}if(buffer){obj.children.push(buffer);buffer=""}return obj}},{key:"unserialize",value:function unserialize(json){Component.prototype.unserialize.call(this,json);var page=this.page();var lastCharJSON=null;if(!Array.isArray(json.children)){return}var _iteratorNormalCompletion18=true;var _didIteratorError18=false;var _iteratorError18=undefined;try{for(var _iterator18=json.children[Symbol.iterator](),_step18;!(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done);_iteratorNormalCompletion18=true){var childJSON=_step18.value;if(childJSON["class"]=="InlineCharacter"){lastCharJSON=clone(childJSON)}if(typeof childJSON=="string"){if(!lastCharJSON){continue}var _iteratorNormalCompletion19=true;var _didIteratorError19=false;var _iteratorError19=undefined;try{for(var _iterator19=childJSON.split("")[Symbol.iterator](),_step19;!(_iteratorNormalCompletion19=(_step19=_iterator19.next()).done);_iteratorNormalCompletion19=true){var char=_step19.value;lastCharJSON.char=char;this.insertLast(page.restoreComponentTree(lastCharJSON,this))}}catch(err){_didIteratorError19=true;_iteratorError19=err}finally{try{if(!_iteratorNormalCompletion19&&_iterator19["return"]){_iterator19["return"]()}}finally{if(_didIteratorError19){throw _iteratorError19}}}continue}this.insertLast(page.restoreComponentTree(childJSON,this))}}catch(err){_didIteratorError18=true;_iteratorError18=err}finally{try{if(!_iteratorNormalCompletion18&&_iterator18["return"]){_iterator18["return"]()}}finally{if(_didIteratorError18){throw _iteratorError18}}}}}]);return ComponentWithInlineEditing}(ComponentWithChildren);module.exports=ComponentWithInlineEditing},{"../../bars/InlineEditingBar":5,"../../helpers/canParentTakeChildren":547,"../../helpers/getDimensions":569,"../../helpers/getElementNodes":570,"../../helpers/getElementTextNodes":571,"../../helpers/htmlToInline":579,"../../helpers/inlineCompare":580,"../../helpers/inlineToDOM":581,"../../helpers/inlineToHTML":582,"../../helpers/keyChecker":586,"./Component":39,"./ComponentWithChildren":40,"./InlineCharacter":57,"./InputBase":58,"clone":739}]
});
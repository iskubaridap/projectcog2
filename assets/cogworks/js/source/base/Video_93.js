define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SelectOption=require("../../panels/SelectOption");var TextBoxOption=require("../../panels/TextBoxOption");var CheckBoxOption=require("../../panels/CheckBoxOption");var ComponentListOption=require("../../panels/ComponentListOption");var Component=require("./Component");var parse=require("url").parse;var clone=require("clone");var vimeoRegex=require("vimeo-regex")();var Video=function(_Component){_inherits(Video,_Component);function Video(){_classCallCheck(this,Video);_get(Object.getPrototypeOf(Video.prototype),"constructor",this).call(this);this.iframe=$("<iframe>");this.video=$("<video>");this.element=this.video;this.sources=[];this.tracks=[];this.defineGroups([{id:"video-sources",label:"Video Sources"},{id:"video-tracks",label:"Video Tracks"}]);var vid=this;this.defineProperties([{id:"type",label:"Type",type:"select",value:"youtube",options:Video.possibleTypes},{id:"url",label:vid.getVideoServiceName()+" URL",type:"textbox",value:"",visible:function visible(){return!vid.isHTML5()}},{id:"width",label:"Width",type:"textbox",value:"560"},{id:"height",label:"Height",type:"textbox",value:"315"},{id:"preload",label:"Preload",type:"select",value:"",options:Video.possiblePreloadValues,visible:function visible(){return vid.isHTML5()}},{id:"poster",label:"Poster URL",type:"textbox",value:"",visible:function visible(){return vid.isHTML5()}},{id:"autoplay",label:"Autoplay",type:"checkbox",value:false},{id:"loop",label:"Loop",type:"checkbox",value:false},{id:"muted",label:"Muted",type:"checkbox",value:false,visible:function visible(){return vid.isHTML5()}},{id:"controls",label:"Show Controls",type:"checkbox",value:true,visible:function visible(){return vid.isHTML5()}},{id:"yt-suggested",label:"Show Suggested Videos",type:"checkbox",value:true,visible:function visible(){return vid.isYouTube()}},{id:"yt-controls",label:"Show Player Controls",type:"checkbox",value:true,visible:function visible(){return vid.isYouTube()}},{id:"yt-title",label:"Show Video Title",type:"checkbox",value:true,visible:function visible(){return vid.isYouTube()}},{id:"yt-privacy",label:"Privacy-Ehnanced Mode",type:"checkbox",value:false,visible:function visible(){return vid.isYouTube()}},{id:"vm-title",label:"Show Video Title",type:"checkbox",value:true,visible:function visible(){return vid.isVimeo()}},{id:"vm-portrait",label:"Show Author Portrait",type:"checkbox",value:true,visible:function visible(){return vid.isVimeo()}},{id:"vm-byline",label:"Show Author Byline",type:"checkbox",value:true,visible:function visible(){return vid.isVimeo()}}])}_createClass(Video,[{key:"isHTML5",value:function isHTML5(){return this.properties.type=="html5"}},{key:"isYouTube",value:function isYouTube(){return this.properties.type=="youtube"}},{key:"isVimeo",value:function isVimeo(){return this.properties.type=="vimeo"}},{key:"getVideoServiceName",value:function getVideoServiceName(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Video.possibleTypes[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var type=_step.value;if(type.value==this.properties.type){return type.label}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return""}},{key:"injectOptions",value:function injectOptions(){app.framework.getOptionsGroupByID("video-sources").add(new ComponentListOption({component:this,items:[this,"sources"],itemRepresentation:function itemRepresentation(item){var text=item.src.trim();if(!text.length){text="<"+item.type+">"}return text},actions:{delete:true,edit:true},visible:this.isHTML5.bind(this),addForm:function addForm(){var type=new SelectOption({label:"Mime Type",value:Video.supportedMimeTypes[0],options:Video.supportedMimeTypes});var src=new TextBoxOption({label:"Source",value:""});return[type,src]},editForm:function editForm(item){var type=new SelectOption({label:"Mime Type",value:item.type||Video.supportedMimeTypes[0],options:Video.supportedMimeTypes});var src=new TextBoxOption({label:"Source",
value:item.src||""});return[type,src]},onFormSave:function onFormSave(fields){return{type:fields[0].val(),src:fields[1].val()}}}));app.framework.getOptionsGroupByID("video-tracks").add(new ComponentListOption({component:this,items:[this,"tracks"],itemRepresentation:function itemRepresentation(item){var text=item.src.trim();if(!text.length){text="<"+item.kind+">"}return text},actions:{delete:true,edit:true},visible:this.isHTML5.bind(this),addForm:function addForm(){var kind=new SelectOption({label:"Track Kind",value:Video.possibleTrackTypes[0],options:Video.possibleTrackTypes});var src=new TextBoxOption({label:"Source",value:""});var srclang=new TextBoxOption({label:"Language",value:""});var label=new TextBoxOption({label:"Label",value:""});return[kind,src,srclang,label]},editForm:function editForm(item){var kind=new SelectOption({label:"Track Type",value:item.type||Video.possibleTrackTypes[0],options:Video.possibleTrackTypes});var src=new TextBoxOption({label:"Source",value:item.src||""});var srclang=new TextBoxOption({label:"Language",value:item.srclang||""});var label=new TextBoxOption({label:"Label",value:item.label||""});return[kind,src,srclang,label]},onFormSave:function onFormSave(fields){return{kind:fields[0].val(),src:fields[1].val(),srclang:fields[2].val(),label:fields[3].val()}}}))}},{key:"update",value:function update(){var elem;delete this.attributes.allowfullscreen;delete this.attributes.frameborder;delete this.attributes.src;delete this.attributes.width;delete this.attributes.height;if(this.properties.width){this.attributes.width=this.properties.width}if(this.properties.height){this.attributes.height=this.properties.height}if(this.isHTML5()){elem=this.video.empty();delete this.attributes.autoplay;delete this.attributes.preload;delete this.attributes.poster;delete this.attributes.muted;delete this.attributes.controls;delete this.attributes.loop;if(this.properties.autoplay&&!this.context().isDesign){this.attributes.autoplay=""}if(this.properties.preload){this.attributes.preload=this.properties.preload}if(this.properties.poster){this.attributes.poster=this.properties.poster}if(this.properties.muted){this.attributes.muted=""}if(this.properties.controls){this.attributes.controls=""}if(this.properties.loop){this.attributes.loop=""}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.sources[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var source=_step2.value;var src=document.createElement("source");if(source.src)src.src=source.src;if(source.type)src.type=source.type;elem.append(src)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.tracks[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var track=_step3.value;var tr=document.createElement("track");if(track.src)tr.src=track.src;if(track.kind)tr.kind=track.kind;if(track.srclang)tr.srclang=track.srclang;if(track.label)tr.label=track.label;elem.append(tr)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}else{elem=this.iframe;this.attributes.allowfullscreen="";this.attributes.frameborder="0";var url="https://";var parsed=parse(this.properties.url,true);if(this.isYouTube()){var videoID=null;if(parsed.hostname=="www.youtube.com"&&parsed.query&&parsed.query.v){videoID=parsed.query.v}if(parsed.hostname=="www.youtube.com"&&parsed.pathname&&/^\/embed\/[^\/]+$/.test(parsed.pathname)){videoID=parsed.pathname.match(/\/embed\/([^\/]+)/)[1]}if(parsed.hostname=="youtu.be"&&parsed.pathname){videoID=parsed.pathname.slice(1)}if(videoID){if(this.properties["yt-privacy"]){url+="www.youtube-nocookie.com/embed/"}else{url+="www.youtube.com/embed/"}url+=videoID+"?";if(this.properties.autoplay&&!this.context().isDesign){url+="autoplay=1&"}if(this.properties.loop){url+="loop=1&playlist="+videoID+"&"}if(!this.properties["yt-controls"]){url+="controls=0&"}if(!this.properties["yt-title"]){url+="showinfo=0&"}if(!this.properties["yt-suggested"]){url+="rel=0&"}this.attributes.src=url.slice(0,-1)}}else if(this.isVimeo()&&parsed.hostname=="vimeo.com"&&vimeoRegex.test(this.properties.url)&&vimeoRegex.exec(this.properties.url)[4]){url+="player.vimeo.com/video/"+vimeoRegex.exec(this.properties.url)[4]+"?";if(this.properties.autoplay&&!this.context().isDesign){url+="autoplay=1&"}if(this.properties.loop){url+="loop=1&"}if(!this.properties["vm-portrait"]){url+="portrait=0&"}if(!this.properties["vm-title"]){url+="title=0&"}if(!this.properties["vm-byline"]){url+="byline=0&"}this.attributes.src=url.slice(0,-1)}}this.element.replaceWith(elem);this.element=elem;return _get(Object.getPrototypeOf(Video.prototype),"update",this).call(this)}},{key:"serialize",value:function serialize(){var obj=_get(Object.getPrototypeOf(Video.prototype),"serialize",this).call(this);obj.sources=this.sources;obj.tracks=this.tracks;return obj}},{key:"unserialize",value:function unserialize(obj){_get(Object.getPrototypeOf(Video.prototype),"unserialize",this).call(this,obj);if(Array.isArray(obj.sources)){this.sources=clone(obj.sources)}if(Array.isArray(obj.tracks)){this.tracks=clone(obj.tracks)}}},{key:"convertUp",value:function convertUp(){var vid=new Video;vid.initialize();this.transferDefinedPropsTo(vid);return this.framework().convertUpFromTo(this,vid)}}]);return Video}(Component);Video.possibleTypes=[{label:"YouTube",value:"youtube"},{label:"Vimeo",value:"vimeo"},{label:"HTML5",value:"html5"}];Video.possiblePreloadValues=[{label:"Default",value:""},{label:"None",value:"none"},{label:"Metadata",value:"metadata"},{label:"Auto",value:"auto"}];Video.supportedMimeTypes=[{label:"video/webm",value:"video/webm"},{label:"video/mp4",value:"video/mp4"},{label:"video/ogg",value:"video/ogg"},{label:"audio/mp4",value:"audio/mp4"},{label:"audio/mpeg",value:"audio/mpeg"},{label:"audio/wav",value:"audio/wav"},{label:"audio/ogg",value:"audio/ogg"}];Video.possibleTrackTypes=[{label:"Subtitles",value:"subtitles"},{label:"Captions",value:"captions"},{label:"Descriptions",value:"descriptions"},{label:"Chapters",value:"chapters"},{label:"Metadata",value:"metadata"}];Video.description="This is a component for displaying videos. It can show YouTube or Vimeo media, but also self-hosted videos by using the <code>&lt;video&gt;</code> HTML5 element.";module.exports=Video},{"../../panels/CheckBoxOption":1213,"../../panels/ComponentListOption":1215,"../../panels/SelectOption":1238,"../../panels/TextBoxOption":1243,"./Component":39,"clone":739,"url":1194,"vimeo-regex":1200}]
});
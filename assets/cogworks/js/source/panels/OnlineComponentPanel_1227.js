define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x3,_x4,_x5){var _again=true;_function:while(_again){var object=_x3,property=_x4,receiver=_x5;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x3=parent;_x4=property;_x5=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ComponentPanel=require("./ComponentPanel.js");var PackageTreeGroup=require("../tree/PackageTreeGroup");var DownloadedPackage=require("../packages/DownloadedPackage");var OnlineResult=require("./OnlineResult");var OnlineComponentPanel=function(_ComponentPanel){_inherits(OnlineComponentPanel,_ComponentPanel);function OnlineComponentPanel(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,OnlineComponentPanel);_get(Object.getPrototypeOf(OnlineComponentPanel.prototype),"constructor",this).call(this,options);this.id="online";this.name="Online";this.icon="wifi";this.onlineSearchCache=[];this.onlineHomepage=[];var self=this;app.on("package-tree-changed",function(op){var items=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];if(items[0]instanceof DownloadedPackage&&self.tooltip.isVisible()&&(op=="download"||op=="uninstall")){return}if(self.tooltip.isVisible()){self.tooltip.hide()}if(op=="share"||op=="unshare"){self.onlineSearchCache.length=0}self.scheduleUpdate()})}_createClass(OnlineComponentPanel,[{key:"clearSearch",value:function clearSearch(){_get(Object.getPrototypeOf(OnlineComponentPanel.prototype),"clearSearch",this).call(this);clearTimeout(this._pendingOnlineSearch)}},{key:"onSearch",value:function onSearch(e){_get(Object.getPrototypeOf(OnlineComponentPanel.prototype),"onSearch",this).call(this,e);clearTimeout(this._pendingOnlineSearch)}},{key:"buildOnlineHomepage",value:function buildOnlineHomepage(data){var trendingResults=new PackageTreeGroup;trendingResults.initialize("Trending",data.trending.map(function(c){return new OnlineResult(c)}));trendingResults.system=true;trendingResults.expanded=true;var latestResults=new PackageTreeGroup;latestResults.initialize("Latest",data.latest.map(function(c){return new OnlineResult(c)}));latestResults.system=true;latestResults.expanded=true;this.onlineHomepage=[trendingResults,latestResults]}},{key:"updateComponents",value:function updateComponents(){var searchString=this.searchString.trim();var container=this.scrollable.empty();var nothingFoundMessage=this.element.find(".nothing-found");nothingFoundMessage.hide();var cantReachServers=this.element.find(".cant-reach-servers");cantReachServers.hide();this.element.removeClass("loading");if(this._pendingSearchAJAXRequest){this._pendingSearchAJAXRequest.abort()}if(this.isSearching()){clearTimeout(this._pendingOnlineSearch);if(this.isOnlineSearchCached(searchString)){var data=this.getOnlineSearchCache(searchString).result;if(data.length){container.html(this.renderOnlineResults(data))}else{nothingFoundMessage.show()}return}this.element.addClass("loading");var that=this;this._pendingOnlineSearch=setTimeout(function(){this._pendingSearchAJAXRequest=$.get("/app/library/search-components",{s:searchString}).done(function(data){that.cacheOnlineSearch(searchString,data);if(!data.length){nothingFoundMessage.show();return}container.html(that.renderOnlineResults(data))}).fail(function(e){cantReachServers.show()}).always(function(){that.element.removeClass("loading")})},2e3);return}if(this.onlineHomepage.length){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.onlineHomepage[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var group=_step.value;container.append(this.renderComponentFolder(group));this.silentInstantExpandGroup(group)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}else{cantReachServers.show()}}},{key:"cacheOnlineSearch",value:function cacheOnlineSearch(searchString,result){this.onlineSearchCache.unshift({searchString:searchString,result:result});if(this.onlineSearchCache.length>10){this.onlineSearchCache.length=10}}},{key:"isOnlineSearchCached",value:function isOnlineSearchCached(searchString){for(var i=0;i<this.onlineSearchCache.length;i++){if(this.onlineSearchCache[i].searchString==searchString){return true}}return false}},{key:"getOnlineSearchCache",value:function getOnlineSearchCache(searchString){for(var i=0;i<this.onlineSearchCache.length;i++){if(this.onlineSearchCache[i].searchString==searchString){var tmp=this.onlineSearchCache[i];this.onlineSearchCache[i]=this.onlineSearchCache[0];this.onlineSearchCache[0]=tmp;return tmp}}return null}},{key:"renderOnlineResults",value:function renderOnlineResults(json){var fragment=document.createDocumentFragment();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=json[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var comp=_step2.value;var onlineResult=new OnlineResult(comp);fragment.appendChild(this.renderComponent(onlineResult))}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return fragment}}]);return OnlineComponentPanel}(ComponentPanel);module.exports=OnlineComponentPanel},{"../packages/DownloadedPackage":1204,"../tree/PackageTreeGroup":1264,"./ComponentPanel.js":1216,"./OnlineResult":1228}]
});
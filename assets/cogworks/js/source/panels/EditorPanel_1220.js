define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x4,_x5,_x6){var _again=true;_function:while(_again){var object=_x4,property=_x5,receiver=_x6;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x4=parent;_x5=property;_x6=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Panel=require("./Panel.js");var tabHandler=require("../helpers/tabHandler");var isContextClick=require("../helpers/isContextClick");var resizeHandler=require("../helpers/resizeHandler");var EditorPanel=function(_Panel){_inherits(EditorPanel,_Panel);function EditorPanel(element){_classCallCheck(this,EditorPanel);_get(Object.getPrototypeOf(EditorPanel.prototype),"constructor",this).call(this,element);this.element=element;this.leftEditorContent=element.find("#left-editor .editor-content");this.rightEditorContent=element.find("#right-editor .editor-content");this.leftEditorTabHolder=element.find("#left-editor .tab-holder");this.rightEditorTabHolder=element.find("#right-editor .tab-holder");this.leftEditorGroup=null;this.rightEditorGroup=null;this.tabToEditor=new WeakMap;this.editorToTab=new WeakMap;this.tabIsDragged=false;this.heightBeforeContract=0;this._scheduleScanTimer=null;this._scheduleScanFunc=function(){this.scanEditors()}.bind(this);tabHandler({app:app,tabAreas:[element.find("#left-editor .editor-tabs"),element.find("#right-editor .editor-tabs")],onClick:this.tabClick.bind(this),onChange:this.afterTabReorder.bind(this),startDrag:this.tabStartDrag.bind(this),endDrag:this.tabEndDrag.bind(this)});this.element.on("click",".editor-tabs",this.tabsClick.bind(this));this.element.on("mousedown",".handle",this.onResize.bind(this));app.on("context-activated",this.contextActivated.bind(this));app.on("context-closed",this.contextClosed.bind(this));app.on("resource-changed",this.resourceChanged.bind(this));app.on("component-updated",this.componentUpdated.bind(this));app.on("package-removed",this.packageRemoved.bind(this));this.panelReady()}_createClass(EditorPanel,[{key:"packageRemoved",value:function packageRemoved(){this.scheduleEditorScan()}},{key:"componentUpdated",value:function componentUpdated(component){this.scheduleEditorScan()}},{key:"resourceChanged",value:function resourceChanged(type,action,res){if(action=="edit"&&this.isBeingEdited(res)){this.updateTabs()}else{this.scheduleEditorScan()}}},{key:"setEditorGroups",value:function setEditorGroups(left,right){if(this.leftEditorGroup){this.leftEditorGroup.deactivate()}if(this.rightEditorGroup){this.rightEditorGroup.deactivate()}left.activate();right.activate();this.leftEditorGroup=left;this.rightEditorGroup=right}},{key:"focusEditorAndExpand",value:function focusEditorAndExpand(editor){if(!editor.isActive()){this.activateEditorAndUpdate(editor)}this.expand()}},{key:"openForEditing",value:function openForEditing(target){var editor=this.getEditorForTarget(target);if(!editor){editor=target.createEditor();this.rightEditorGroup.add(editor);this.activateEditorAndUpdate(editor)}else if(!editor.isActive()){this.activateEditorAndUpdate(editor)}this.expand();return editor}},{key:"isBeingEdited",value:function isBeingEdited(target){return!!this.getEditorForTarget(target)}},{key:"getEditorForTarget",value:function getEditorForTarget(target){return this.rightEditorGroup.findByTarget(target)||this.leftEditorGroup.findByTarget(target)}},{key:"closeEditorForTarget",value:function closeEditorForTarget(target){var editor=this.getEditorForTarget(target);this.closeEditor(editor)}},{key:"closeEditor",value:function closeEditor(editor){if(editor.system)return;var updateLeftGroup=false,updateRightGroup=false;if(this.leftEditorGroup.has(editor)){if(editor.isActive()){updateLeftGroup=true}this.leftEditorGroup.remove(editor);editor.destructor()}if(this.rightEditorGroup.has(editor)){if(editor.isActive()){updateRightGroup=true}this.rightEditorGroup.remove(editor);editor.destructor()}if(updateLeftGroup){this.updateLeftGroup()}if(updateRightGroup){this.updateRightGroup()}this.updateTabs()}},{key:"activateEditorAndUpdate",value:function activateEditorAndUpdate(editor){if(this.rightEditorGroup.has(editor)){this.rightEditorGroup.activateEditor(editor);this.updateRightGroup();this.updateTabs()}if(this.leftEditorGroup.has(editor)){this.leftEditorGroup.activateEditor(editor);this.updateLeftGroup();this.updateTabs()}}},{key:"hasTextSelection",value:function hasTextSelection(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.getAllEditors()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var editor=_step.value;if(editor.hasTextSelection()){return true}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return false}},{key:"tabClick",value:function tabClick(e){var editor=this.tabToEditor.get(e.target.closest(".tab"));if(!editor)return;if(isContextClick(e)){e.stopPropagation();return}if(e.button==1){this.closeEditor(editor);return}if(e.target.matches(".close")){this.closeEditor(editor);return}if(!editor.isActive()){var elem=$(e.target);if(elem.is(".active"))return;this.activateEditorAndUpdate(editor)}this.expand()}},{key:"afterTabReorder",value:function afterTabReorder(prop){var that=this,leftItems=[],rightItems=[];var updateLeftGroup=false,updateRightGroup=false,activeMovedToLeft=false,activeMovedToRight=false;this.leftEditorTabHolder.find(".tab").each(function(){leftItems.push(that.tabToEditor.get(this))});this.rightEditorTabHolder.find(".tab").each(function(){rightItems.push(that.tabToEditor.get(this))});var draggedEditor=this.tabToEditor.get(prop.tab);if(draggedEditor.isActive()){if(this.rightEditorGroup.has(draggedEditor)&&rightItems.indexOf(draggedEditor)==-1){this.rightEditorGroup.remove(draggedEditor);activeMovedToLeft=true}if(this.leftEditorGroup.has(draggedEditor)&&leftItems.indexOf(draggedEditor)==-1){this.leftEditorGroup.remove(draggedEditor);activeMovedToRight=true}}this.leftEditorGroup.set(leftItems);this.rightEditorGroup.set(rightItems);if(activeMovedToLeft){this.rightEditorContent.empty();this.leftEditorGroup.activateEditor(draggedEditor)}if(activeMovedToRight){this.leftEditorContent.empty();this.rightEditorGroup.activateEditor(draggedEditor)}if(this.leftEditorGroup.length&&!this.leftEditorGroup.activeEditor){this.leftEditorGroup.activateEditor();updateLeftGroup=true}if(this.rightEditorGroup.length&&!this.rightEditorGroup.activeEditor){this.rightEditorGroup.activateEditor();updateRightGroup=true}this.updateTabs();if(activeMovedToRight||activeMovedToLeft||updateLeftGroup){this.updateLeftGroup()}if(activeMovedToRight||activeMovedToLeft||updateRightGroup){this.updateRightGroup()}}},{key:"tabStartDrag",value:function tabStartDrag(){this.tabIsDragged=true}},{key:"tabEndDrag",value:function tabEndDrag(){var that=this;setTimeout(function(){that.tabIsDragged=false},50)}},{key:"tabsClick",value:function tabsClick(e){if(this.tabIsDragged)return;var elem=$(e.target);if(this.isExpanded()){if(elem.closest(".tab").length)return;this.contract()}else{this.expand()}}},{key:"isExpanded",value:function isExpanded(){return this.element.hasClass("expanded")}},{key:"toggle",value:function toggle(){if(this.isExpanded()){return this.contract()}this.expand()}},{key:"contract",value:function contract(){if(!this.element.hasClass("expanded"))return;this.heightBeforeContract=this.element.height();this.element.height(28);this.element.removeClass("expanded");app.trigger("panel-resize")}},{key:"expand",value:function expand(){if(this.element.hasClass("expanded"))return;var height=this.heightBeforeContract;if(height<150){height=win.height()/2}this.element.height(height);this.element.addClass("expanded");app.trigger("panel-resize")}},{key:"onResize",value:function onResize(e){e.preventDefault();var handle=$(e.target);var target=$(handle.data("target"));if(!target.length)return;var dimensions=target[0].getBoundingClientRect();var canToggleClass=!!handle.data("toggle-class");var toggleClass=null;var toggleEnable=null;var toggleDisable=null;var toggleStatus=false;if(canToggleClass){toggleClass=handle.data("toggle-class");toggleEnable=handle.data("toggle-enable");toggleDisable=handle.data("toggle-disable")}var oldHeight=dimensions.height;var that=this;var handler=resizeHandler({type:handle.data("type"),dimensions:{width:dimensions.width,height:dimensions.height,minHeight:handle.data("min"),maxHeight:handle.data("max")||(win.height()-50)*.9},onResize:function onResize(_ref){var width=_ref.width;var height=_ref.height;width&&target.width(width);height&&target.height(height);var horizontalDirection=height-oldHeight;if(canToggleClass){toggleStatus=target.hasClass(toggleClass);if(horizontalDirection<0&&toggleStatus&&height<toggleDisable){target.removeClass(toggleClass);height=handle.data("min");target.height(height);handler.stopResize()}if(horizontalDirection>0&&!toggleStatus&&height>toggleEnable){target.addClass(toggleClass)}}oldHeight=height;app.trigger("panel-resizing")},onResizeEnd:function onResizeEnd(wasResized){if(!wasResized){that.toggle()}app.trigger("panel-resize")}})}},{key:"contextActivated",value:function contextActivated(){this.setEditorGroups(app.context.leftEditorGroup,app.context.rightEditorGroup);this.update()}},{key:"contextClosed",value:function contextClosed(ctx){ctx.destructEditors()}},{key:"scheduleEditorScan",value:function scheduleEditorScan(){var time=arguments.length<=0||arguments[0]===undefined?50:arguments[0];clearTimeout(this._scheduleScanTimer);this._scheduleScanTimer=setTimeout(this._scheduleScanFunc,time)}},{key:"saveAllEditors",value:function saveAllEditors(){var context=arguments.length<=0||arguments[0]===undefined?null:arguments[0];context=context||app.context;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.getAllEditors(context)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var editor=_step2.value;if(editor.isSaved&&!editor.isSaved()){editor.save()}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"getAllEditors",value:function getAllEditors(){var context=arguments.length<=0||arguments[0]===undefined?null:arguments[0];var leftGroup=context?context.leftEditorGroup:this.leftEditorGroup;var rightGroup=context?context.rightEditorGroup:this.rightEditorGroup;return leftGroup.getAll().concat(rightGroup.getAll())}},{key:"scanEditors",value:function scanEditors(){var updateTabs=false,updateLeftGroup=false,updateRightGroup=false;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.leftEditorGroup.getAll()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var editor=_step3.value;if(editor.system)continue;if(!editor.targetExists()){if(editor.isActive()){updateLeftGroup=true}this.leftEditorGroup.remove(editor);editor.destructor();updateTabs=true}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.rightEditorGroup.getAll()[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var editor=_step4.value;if(editor.system)continue;if(!editor.targetExists()){if(editor.isActive()){updateRightGroup=true}this.rightEditorGroup.remove(editor);editor.destructor();updateTabs=true}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}if(updateTabs){this.updateTabs()}if(updateLeftGroup){this.updateLeftGroup()}if(updateRightGroup){this.updateRightGroup()}}},{key:"updateLeftGroup",value:function updateLeftGroup(){this.leftEditorContent.html(this.leftEditorGroup.scheduleUpdate());if(this.leftEditorGroup.activeEditor){this.leftEditorGroup.activeEditor.restoreScrollOffset()}}},{key:"updateRightGroup",value:function updateRightGroup(){this.rightEditorContent.html(this.rightEditorGroup.scheduleUpdate());if(this.rightEditorGroup.activeEditor){this.rightEditorGroup.activeEditor.restoreScrollOffset()}}},{key:"updateTabs",value:function updateTabs(){var tabs=[];var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=this.leftEditorGroup.getAll()[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var e=_step5.value;var tab=this.renderTabForEditor(e);tabs.push(tab);this.tabToEditor.set(tab[0],e);this.editorToTab.set(e,tab[0])}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}this.leftEditorTabHolder.html(tabs);tabs=[];var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.rightEditorGroup.getAll()[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var e=_step6.value;var tab=this.renderTabForEditor(e);tabs.push(tab);this.tabToEditor.set(tab[0],e);this.editorToTab.set(e,tab[0])}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]){_iterator6["return"]()}}finally{if(_didIteratorError6){throw _iteratorError6}}}this.rightEditorTabHolder.html(tabs)}},{key:"updateTabForEditor",value:function updateTabForEditor(editor){var node=this.editorToTab.get(editor);if(!node)return;var newNode=this.renderTabForEditor(editor);$(node).replaceWith(newNode);this.tabToEditor.set(newNode[0],editor);this.editorToTab.set(editor,newNode[0])}},{key:"renderTabForEditor",value:function renderTabForEditor(editor){var tab=$('<div class="tab">\n\t\t\t<span class="title"></span>\n\t\t\t<span class="close"></span>\n\t\t</div>');tab[0].firstElementChild.textContent=editor.getName();tab.toggleClass("active",editor.isActive());tab.toggleClass("can-be-closed",!editor.system);if(editor.isSaved){tab.toggleClass("unsaved",!editor.isSaved())}return tab}},{key:"update",value:function update(){this.updateLeftGroup();this.updateRightGroup();this.updateTabs();return this.element}}]);return EditorPanel}(Panel);module.exports=EditorPanel},{"../helpers/isContextClick":584,"../helpers/resizeHandler":603,"../helpers/tabHandler":618,"./Panel.js":1234}]
});
define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var color=require("onecolor");var positionElementNextToPoint=require("../helpers/positionElementNextToPoint");var colorLibrary=require("../config/color-library");var ColorPicker=function(){function ColorPicker(element){_classCallCheck(this,ColorPicker);this.element=element;this.originalColor=null;this.color={};this.format="hex";this.activeTab="select";this.selectTab=this.element.find(".tab-target.select");this.swatchTab=this.element.find(".tab-target.swatch");this.active=false;this.mouseOverColorPicker=false;this.lastClickTime=null;this.lastClickColor=null;this.windowColorAtMouse=null;this.windowColorSelectionActive=false;this.screenshotCanvas=document.createElement("canvas");this.screenshotLoaded=false;this.cursorCanvas=document.createElement("canvas");this.cursorCanvas.width=60;this.cursorCanvas.height=60;this.cursorCanvasCtx=this.cursorCanvas.getContext("2d");this.gradientBox=null;this.overlay=$("#color-picker-overlay");this.overlayIsVisible=false;this.windowColorSelectionElement=$("#window-color-selection");this.hueSlider=this.element.find(".hue");this.alphaSlider=this.element.find(".alpha");this.formatDropdown=this.element.find(".format");this.valueField=this.element.find(".value");this.newColor=this.element.find(".new-color");this.oldColor=this.element.find(".old-color");this.favoriteButton=this.element.find(".favorite");this.gradientElement=this.element.find(".gradient");this.colorSelection=this.element.find(".selection");this.hueSlider.on("input",this.hueSlide.bind(this));this.alphaSlider.on("input",this.alphaSlide.bind(this));this.formatDropdown.on("change",this.formatChange.bind(this));this.valueField.on("change",this.fieldChange.bind(this));this.element.on("click",".tab",this.tabClick.bind(this));this.element.on("click",".favorite",this.favoriteClick.bind(this));this.element.on("click",".picker",this.pickerClick.bind(this));this.element.on("click",".old-color",this.originalColorClick.bind(this));this.element.on("click",".select-button",this.selectClick.bind(this));this.element.on("click",".cancel-button",this.cancelClick.bind(this));this.element.on("click",".color",this.colorClick.bind(this));this.element.on("mousedown",".gradient, .selection",this.startColorSelection.bind(this));this.element.on("mouseenter",this.mouseEnter.bind(this));this.element.on("mouseleave",this.mouseLeave.bind(this));app.on("mouseup",this.mouseUp.bind(this));app.on("mousedown",this.mouseDown.bind(this));app.on("mousemove",this.mouseMove.bind(this));app.on("resize",this.appResized.bind(this));app.on("context-closed context-changed",this.discard.bind(this));app.on("component-unselected panel-resize resize",this.windowChanged.bind(this));app.on("screenshot-ready",this.screenshotReady.bind(this));var that=this;app.on("keydown",function(e){if(!that.active)return;if(e.which==27){if(that.windowColorSelectionActive){that.deactivateWindowColorSelection()}else{that.discard()}return false}if(e.which==13){if(that.windowColorSelectionActive){that.selectWindowColor();that.deactivateWindowColorSelection()}else{that.select()}return false}},-10)}_createClass(ColorPicker,[{key:"appResized",value:function appResized(){this.discard()}},{key:"mouseUp",value:function mouseUp(e){this.mouseIsDown=false;if(this.windowColorSelectionActive){this.windowColorSelectionClick()}}},{key:"mouseDown",value:function mouseDown(e){if(this.active&&!this.mouseOverColorPicker){if(this.windowColorSelectionActive)return;this.select()}}},{key:"mouseEnter",value:function mouseEnter(){this.mouseOverColorPicker=true}},{key:"mouseLeave",value:function mouseLeave(){this.mouseOverColorPicker=false}},{key:"mouseMove",value:function mouseMove(e){if(this.windowColorSelectionActive){this.windowColorSelectionMousemove()}if(this.mouseIsDown){e.preventDefault();this.color=this.gradientColorAtCoordinates(app.mousePosition.x-this.gradientBox.x,app.mousePosition.y-this.gradientBox.y);this.notifyOfColorChange();this.update()}}},{key:"tabClick",value:function tabClick(e){var clickedTab=e.target.dataset.tab;if(clickedTab==this.activeTab){return}this.activeTab=clickedTab;if(clickedTab=="select"){this.selectTab.addClass("active");this.swatchTab.removeClass("active")}else{this.selectTab.removeClass("active");this.swatchTab.addClass("active")}this.element.find(".tab").removeClass("active");e.target.classList.add("active");this.update()}},{key:"registerColorClick",value:function registerColorClick(){if(this.lastClickTime&&Date.now()-this.lastClickTime<300&&this.lastClickColor==this.color.cssa()){this.select();return}this.lastClickTime=Date.now();this.lastClickColor=this.color.cssa()}},{key:"colorClick",value:function colorClick(e){var col=e.currentTarget.firstChild.style.backgroundColor;this.color=color(col);if(this.color.alpha()<1){this.format="rgb"}else{this.format="hex"}this.update();this.notifyOfColorChange();this.registerColorClick()}},{key:"hueSlide",value:function hueSlide(e){this.color=this.color.hue(this.hueSlider.val()/100);this.notifyOfColorChange();this.update()}},{key:"alphaSlide",value:function alphaSlide(e){this.color=this.color.alpha(this.alphaSlider.val()/100);if(this.alphaSlider.val()<100){this.format="rgb"}else{this.format="hex"}this.notifyOfColorChange();this.update()}},{key:"formatChange",value:function formatChange(e){this.format=this.formatDropdown.val();if(this.format=="hex"){this.color=this.color.alpha(1)}this.notifyOfColorChange();this.update()}},{key:"fieldChange",value:function fieldChange(e){var col=color(this.valueField.val());if(col==false)return;this.color=col;this.notifyOfColorChange();this.update()}},{key:"favoriteClick",value:function favoriteClick(e){app.toggleFavoriteColor(this.color.cssa());this.update()}},{key:"pickerClick",value:function pickerClick(e){this.activateWindowColorSelection();var that=this;setTimeout(function(){that.updateScreenshot()},50)}},{key:"originalColorClick",value:function originalColorClick(e){this.color=color(this.originalColor);this.notifyOfColorChange();this.update()}},{key:"selectClick",value:function selectClick(e){this.select()}},{key:"cancelClick",value:function cancelClick(e){this.discard()}},{key:"startColorSelection",
value:function startColorSelection(e){this.mouseIsDown=true;var box=this.gradientElement[0].getBoundingClientRect();this.gradientBox={x:box.left,y:box.top};this.color=this.gradientColorAtCoordinates(app.mousePosition.x-this.gradientBox.x,app.mousePosition.y-this.gradientBox.y);this.notifyOfColorChange();this.update();this.registerColorClick();e.stopPropagation()}},{key:"gradientColorAtCoordinates",value:function gradientColorAtCoordinates(x,y){return this.color.saturation(x/this.gradientElement[0].offsetWidth).value(1-y/this.gradientElement[0].offsetHeight)}},{key:"select",value:function select(){var onSelect=this.options&&this.options.onSelect;var color=this.getNewColorAsCSSString();this.close();if(onSelect){onSelect(color)}}},{key:"discard",value:function discard(){var onCancel=this.options&&this.options.onCancel;this.close();if(onCancel){onCancel()}}},{key:"open",value:function open(options){this.options=options;this.element.show();var arrow=positionElementNextToPoint(this.element[0],options.point);if(arrow){}this.originalColor=color(options.color)||color("#ffffff");this.color=color(options.color)||color("#ffffff");if(options.color.trim().charAt(0)=="#"){this.format="hex"}else{this.format="rgb"}this.update();this.active=true;this.mouseOverColorPicker=false}},{key:"getNewColorAsCSSString",value:function getNewColorAsCSSString(){if(this.format=="rgb"){if(this.color.alpha()<1){return this.color.cssa()}return this.color.css()}return this.color.hex()}},{key:"close",value:function close(){if(this.windowColorSelectionActive){this.deactivateWindowColorSelection()}if(this.active){this.element.hide()}this.active=false;this.options=null}},{key:"hide",value:function hide(){this.element.hide()}},{key:"show",value:function show(){this.element.show()}},{key:"updateSelectTab",value:function updateSelectTab(){var huePos=Math.ceil(this.color.hue()*100);if(huePos==0)huePos=100;this.hueSlider.val(huePos);this.alphaSlider.val(Math.round(this.color.alpha()*100));this.colorSelection.css({left:Math.round(this.color.saturation()*100)+"%",top:100-Math.round(this.color.value()*100)+"%"});this.gradientElement.css("background-color",this.color.saturation(1).value(1).hex());this.newColor.css("background-color",this.color.hex());this.oldColor.css("background-color",this.originalColor.hex())}},{key:"renderSwatchPage",value:function renderSwatchPage(colors){var span,i,focus;var fragment=document.createDocumentFragment();var currentColorAsRGBA=this.color.cssa();var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=colors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var col=_step.value;span=document.createElement("span");span.className="color";i=document.createElement("i");i.style.backgroundColor=col;span.appendChild(i);fragment.appendChild(span);if(col==currentColorAsRGBA){focus=span;span.classList.add("selected")}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}this.swatchTab.empty().append(fragment);if(focus){focus.scrollIntoViewIfNeeded()}}},{key:"updateDesignTab",value:function updateDesignTab(){var colors=app.context.extractColors();colors.reverse();this.renderSwatchPage(colors)}},{key:"updateFavoritesTab",value:function updateFavoritesTab(){this.renderSwatchPage(app.favoriteColors)}},{key:"updateLibraryTab",value:function updateLibraryTab(){this.renderSwatchPage(colorLibrary)}},{key:"update",value:function update(){switch(this.activeTab){case"select":this.updateSelectTab();break;case"design":this.updateDesignTab();break;case"favorites":this.updateFavoritesTab();break;case"library":this.updateLibraryTab();break}this.favoriteButton.toggleClass("active",app.isColorFavorite(this.color.cssa()));this.valueField.val(this.getNewColorAsCSSString().toLowerCase());this.formatDropdown.val(this.format)}},{key:"notifyOfColorChange",value:function notifyOfColorChange(){if(this.options&&this.options.onChange){this.options.onChange(this.getNewColorAsCSSString())}}},{key:"windowChanged",value:function windowChanged(){if(!this.windowColorSelectionActive){return}var that=this;clearTimeout(this.updateScreenshotTimeout);this.updateScreenshotTimeout=setTimeout(function(){that.updateScreenshot()},100)}},{key:"activateWindowColorSelection",value:function activateWindowColorSelection(){if(this.windowColorSelectionActive){return}this.windowColorAtMouse=this.color;this.windowColorSelectionActive=true;this.overlay.show();this.overlayIsVisible=true;this.hide()}},{key:"deactivateWindowColorSelection",value:function deactivateWindowColorSelection(){if(!this.windowColorSelectionActive){return}this.windowColorSelectionActive=false;this.windowColorAtMouse=null;this.overlay.hide();this.overlayIsVisible=false;this.screenshotLoaded=false;this.screenshotCanvas=document.createElement("canvas");this.overlay[0].style.cursor="";this.show()}},{key:"windowColorSelectionMousemove",value:function windowColorSelectionMousemove(){if(!this.screenshotLoaded)return;var devicePixelRatio=window.devicePixelRatio;var data=this.screenshotCanvas.getContext("2d").getImageData(Math.floor(app.mousePosition.x*devicePixelRatio),Math.floor(app.mousePosition.y*devicePixelRatio),1,1).data;this.windowColorAtMouse=color(Array.from(data));this.cursorCanvasCtx.clearRect(0,0,60,60);this.cursorCanvasCtx.beginPath();this.cursorCanvasCtx.arc(30,30,29.5,0,2*Math.PI);this.cursorCanvasCtx.clip();this.cursorCanvasCtx.imageSmoothingEnabled=false;var left=Math.floor(app.mousePosition.x*devicePixelRatio)-2;var offsetLeft=0;if(left<0){offsetLeft=-left;left=0}var top=Math.floor(app.mousePosition.y*devicePixelRatio)-2;var offsetTop=0;if(top<0){offsetTop=-top;top=0}this.cursorCanvasCtx.drawImage(this.screenshotCanvas,left+offsetLeft,top+offsetTop,5,5,0,0,60,60);this.cursorCanvasCtx.strokeStyle="#cccccc";this.cursorCanvasCtx.lineWidth=1;for(var i=0;i<5;i++){this.cursorCanvasCtx.beginPath();this.cursorCanvasCtx.moveTo(i*12+.5,.5);this.cursorCanvasCtx.lineTo(i*12+.5,59.5);this.cursorCanvasCtx.stroke()}this.cursorCanvasCtx.beginPath();this.cursorCanvasCtx.moveTo(59.5,.5);this.cursorCanvasCtx.lineTo(59.5,59.5);this.cursorCanvasCtx.stroke();for(var i=0;i<5;i++){this.cursorCanvasCtx.beginPath();this.cursorCanvasCtx.moveTo(.5,i*12+.5);this.cursorCanvasCtx.lineTo(59.5,i*12+.5);this.cursorCanvasCtx.stroke()}this.cursorCanvasCtx.beginPath();this.cursorCanvasCtx.moveTo(.5,59.5);this.cursorCanvasCtx.lineTo(59.5,59.5);this.cursorCanvasCtx.stroke();this.cursorCanvasCtx.strokeStyle="#ff4f4f";this.cursorCanvasCtx.strokeRect(24.5,24.5,12,12);this.overlay[0].style.cursor="";this.overlay[0].style.cursor="url("+this.cursorCanvas.toDataURL()+") 31 31, default"}},{key:"windowColorSelectionClick",value:function windowColorSelectionClick(){this.selectWindowColor();var that=this;setTimeout(function(){that.deactivateWindowColorSelection()},50)}},{key:"selectWindowColor",value:function selectWindowColor(){if(this.windowColorAtMouse){this.color=this.windowColorAtMouse;this.update();this.notifyOfColorChange()}}},{key:"updateScreenshot",value:function updateScreenshot(){electron.takeScreenshot()}},{key:"screenshotReady",value:function screenshotReady(dataURL){if(!this.windowColorSelectionActive){return}this.screenshotCanvas.width=Math.floor(window.innerWidth*window.devicePixelRatio);this.screenshotCanvas.height=Math.floor(window.innerHeight*window.devicePixelRatio);var ctx=this.screenshotCanvas.getContext("2d");var img=new Image;var that=this;img.onload=function(){ctx.drawImage(img,0,0);that.screenshotLoaded=true};img.src=dataURL}}]);return ColorPicker}();module.exports=ColorPicker},{"../config/color-library":366,"../helpers/positionElementNextToPoint":597,"onecolor":1076}]
});
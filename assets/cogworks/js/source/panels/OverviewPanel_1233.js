define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x2,_x3,_x4){var _again=true;_function:while(_again){var object=_x2,property=_x3,receiver=_x4;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x2=parent;_x3=property;_x4=receiver;_again=true;desc=parent=undefined;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Panel=require("./Panel.js");var Component=require("../components/base/Component");var ComponentWithChildren=require("../components/base/ComponentWithChildren");var canParentTakeChildren=require("../helpers/canParentTakeChildren");var isContextClick=require("../helpers/isContextClick");var isSelectionClick=require("../helpers/isSelectionClick");var dragScroll=require("../helpers/dragScroll");var OverviewPanel=function(_Panel){_inherits(OverviewPanel,_Panel);function OverviewPanel(){var _this=this;var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,OverviewPanel);_get(Object.getPrototypeOf(OverviewPanel.prototype),"constructor",this).call(this,options);this.id="overview";this.name="Overview";this.icon="view_list";this.element.addClass("tree-holder overview-panel");this.supportsMultiSelection=true;this.draggedComponents=[];this.domNodeToComponent=new WeakMap;this.componentToDomNode=new WeakMap;this.expandedMap=new WeakMap;app.on("context-closed",function(){_this._lastClickTime=null;_this._lastClickedComponent=null});app.on("mousemove",this.mousemove.bind(this));app.on("mouseup",this.mouseup.bind(this));app.on("component-selected component-unselected",this.selectionChanged.bind(this));app.on("component-updated",this.componentUpdated.bind(this));app.on("component-unlinked",this.scheduleUpdate.bind(this));this.panelReady()}_createClass(OverviewPanel,[{key:"bindEventListeners",value:function bindEventListeners(){_get(Object.getPrototypeOf(OverviewPanel.prototype),"bindEventListeners",this).call(this);this.element.off(".overview-panel");this.element.on("click.overview-panel","span",this.expandContract.bind(this));this.element.on("mousedown.overview-panel","b",this.mousedownItem.bind(this));this.element.on("mouseenter.overview-panel","b",this.enterItem.bind(this));this.element.on("mouseleave.overview-panel","b",this.leaveItem.bind(this))}},{key:"applicationClick",value:function applicationClick(){}},{key:"selectionChanged",value:function selectionChanged(components){this.scheduleUpdate()}},{key:"componentUpdated",value:function componentUpdated(){if(app.isInlineEditingActive()){return}this.scheduleUpdate()}},{key:"enterItem",value:function enterItem(e){var component=this.domNodeToComponent.get(e.target.parentNode);app.canvas.highlight(component)}},{key:"leaveItem",value:function leaveItem(e){app.canvas.removeHighlight()}},{key:"mousedownItem",value:function mousedownItem(e){var comp=this.domNodeToComponent.get(e.target.parentNode);if(isSelectionClick(e)){var diff=app.context.page.getSelection().click(comp,e);if(diff.added.length){diff.added.forEach(function(o){return o.onSelect()});app.trigger("component-selected",diff.added)}if(diff.removed.length){diff.removed.forEach(function(o){return o.onUnselect()});app.trigger("component-unselected",diff.removed)}var target=null;if(app.context.page.isSingleComponentSelected()){target=app.context.page.getFirstSelectedComponent();app.canvas.scrollToComponent(target)}return}this.isMousedown=true;this.clickedComponent=comp;var now=Date.now();if(this._lastClickTime&&now-this._lastClickTime<500&&this._lastClickedComponent===comp){this.isMousedown=false;this.clickedComponent=null;comp.onOverviewDoubleClick()}else{this._lastClickTime=now;this._lastClickedComponent=comp}this.mousedownStartPosition=app.mousePosition.clone()}},{key:"mousemove",value:function mousemove(e){if(app.isDragging){dragScroll.scroll(this.scrollable[0],this.dimensions,this.contentDimensions,app.mousePosition,{topOffset:70})}else{dragScroll.reset(this.scrollable[0])}if(!this.isMouseOver())return;var target=e.target.nodeName=="SPAN"?e.target:e.target.parentNode;if(app.isDragging){var overComponent=this.domNodeToComponent.get(target);if(this.expandCountdown){clearTimeout(this.expandCountdown);this.expandCountdown=null}if(!overComponent){this.cleanup();return}if(app.draggedComponents.indexOf(overComponent)!=-1){this.cleanup();return}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=app.draggedComponents[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var comp=_step.value;if(overComponent.isChildOf(comp)){this.cleanup();return}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}var isExpanded=this.expandedMap.get(overComponent)||false;var rect=target.getBoundingClientRect();var place="middle",highlight=false,line=false;if(rect.top+6>e.pageY){place="top"}else if(rect.bottom-6<e.pageY){place="bottom"}if(place=="middle"){if(overComponent instanceof ComponentWithChildren){if(canParentTakeChildren(overComponent,app.draggedComponents)){highlight=true;app.dropCall={object:overComponent,method:"insertLast",arguments:[app.draggedComponents]}}var that=this;if(overComponent.children&&!isExpanded){this.expandCountdown=setTimeout(function(){that.expand(overComponent)},400)}}}if(place=="top"){if(canParentTakeChildren(overComponent.parent,app.draggedComponents)){line=true;app.dropCall={object:overComponent.parent,method:"insertBefore",arguments:[app.draggedComponents,overComponent]}}}if(place=="bottom"){if(isExpanded){if(canParentTakeChildren(overComponent,app.draggedComponents)){line=true;app.dropCall={object:overComponent,method:"insertAt",arguments:[app.draggedComponents,0]}}}else if(canParentTakeChildren(overComponent.parent,app.draggedComponents)){line=true;app.dropCall={object:overComponent.parent,method:"insertAfter",arguments:[app.draggedComponents,overComponent]}}}if(line){var coord=place=="top"?rect.top:rect.bottom;if(this.lineIsShown){if(this.lineIsShown==coord){return}this.removeLine()}this.lineIsShown=coord;if(place=="top"){$("<line>").insertBefore(target)}else{$("<line>").insertAfter(target)}}else{this.removeLine()}if(highlight){if(this.highlightIsShown){if(this.highlightIsShown==overComponent){return}this.removeHighlight()}this.highlightIsShown=overComponent;$(target).find("b").addClass("highlighted")}else{this.removeHighlight()}return}if(this.clickedComponent&&!this.clickedComponent.flags.canBeMoved){return}if(this.isMousedown&&app.mousePosition.distanceTo(this.mousedownStartPosition)>=2){var jqt=$(target).find("b");var offset=jqt.offset(),width=jqt.outerWidth(),height=jqt.outerHeight();var component=this.clickedComponent;var components,origin,operation,historyTitle;if(component.isSelected()){if(!app.context.page.canSelectionBeMoved()){return}components=app.context.page.getFlatSelectedComponentsInTreeOrder();operation=app.context.page.moveSelectionOp();if(component.isFocused()){historyTitle="Move "+component.getName()}else{historyTitle="Move Components"}origin=null}else{components=[component];operation=component.moveOp();historyTitle="Move "+component.getName();origin={top:offset.top,left:offset.left,width:width,height:height}}app.dragStart({components:components,historyTitle:"Move "+component.getName(),origin:origin,operation:operation});if(this.clickedComponent.children){this.contract(this.clickedComponent)}}}},{key:"cleanup",value:function cleanup(){this.removeLine();this.removeHighlight()}},{key:"mouseup",value:function mouseup(e){this.isMousedown=false;this.removeLine();this.removeHighlight();if(app.isDragging){this.clickedComponent=null;return}var clicked=this.clickedComponent;this.clickedComponent=null;if(!this.isMouseOver())return;if(clicked&&$(e.target).is("b")){if(isContextClick(e)){if(clicked.isSelected()&&app.context.page.areMultipleComponentsSelected()){app.context.page.showSelectionContextMenu()}else{clicked.showContextMenu()}return}app.canvas.scrollToComponent(clicked);if(!clicked.isFocused()){clicked.focus()}}}},{key:"removeLine",value:function removeLine(){this.lineIsShown=false;this.element.find("line").remove()}},{key:"removeHighlight",value:function removeHighlight(){this.highlightIsShown=false;this.element.find(".highlighted").removeClass("highlighted")}},{key:"expandContract",value:function expandContract(e){if($(e.target).is("b"))return;var component=this.domNodeToComponent.get(e.currentTarget);var status=this.expandedMap.get(component)||false;if(status){this.contract(component)}else{this.expand(component)}e.preventDefault();e.stopImmediatePropagation()}},{key:"expand",value:function expand(component){var span=$(this.componentToDomNode.get(component));span.next(".subtree").slideDown("fast");span.find("i").addClass("down");this.expandedMap.set(component,true)}},{key:"expandParents",value:function expandParents(component){var parent=component;while(parent=parent.parent){this.expandedMap.set(parent,true)}}},{key:"expandSelection",value:function expandSelection(){if(!app.context.page.hasSelection()){return}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=app.context.page.getSelectedComponents()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var comp=_step2.value;this.expandParents(comp)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"contract",value:function contract(component){var span=$(this.componentToDomNode.get(component));span.next(".subtree").slideUp("fast");span.find("i").removeClass("down");this.expandedMap.set(component,false)}},{key:"dragStart",value:function dragStart(components){if(!this.isActive()){this.highlight();this.container.scheduleUpdate()}if(components[0].isSelected()){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=app.context.page.getSelectedComponents()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var comp=_step3.value;this.markAsDragged(comp)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}else{var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=components[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var comp=_step4.value;this.markAsDragged(comp)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}},{key:"dragOver",value:function dragOver(){if(!this.isActive()){this.container.togglePanel(this,true);this.container.scheduleUpdate()}}},{key:"dragEnd",value:function dragEnd(components){var _this2=this;_get(Object.getPrototypeOf(OverviewPanel.prototype),"dragEnd",this).call(this,components);if(components[0].isSelected()){var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=app.context.page.getSelectedComponents()[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var comp=_step5.value;this.markAsNotDragged(comp)}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}else{var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=components[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var comp=_step6.value;this.markAsNotDragged(comp)}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]){_iterator6["return"]()}}finally{if(_didIteratorError6){throw _iteratorError6}}}}this.expandParents(components[0]);setTimeout(function(){_this2.scrollToComponent(components[0])},40)}},{key:"markAsDragged",value:function markAsDragged(component){this.draggedComponents.push(component);if(!this.componentToDomNode.has(component))return;this.componentToDomNode.get(component).classList.add("dragged")}},{key:"markAsNotDragged",value:function markAsNotDragged(component){this.draggedComponents=[];if(!this.componentToDomNode.has(component))return;this.componentToDomNode.get(component).classList.remove("dragged")}},{key:"scrollToComponent",value:function scrollToComponent(comp){var node=this.componentToDomNode.get(comp);node&&node.scrollIntoViewIfNeeded();this.storeScrollPosition()}},{key:"buildPanelContent",value:function buildPanelContent(){if(!app.context){return}var root=document.createDocumentFragment();var cache=this.domNodeToComponent=new WeakMap;var reverseCache=this.componentToDomNode=new WeakMap;var expandedMap=this.expandedMap;var expanded=new Set;var that=this;walk(app.canvas.html,root,0);function walk(component,tip,level){var hasChildren=false;if(expandedMap.has(component)){if(expandedMap.get(component)){expanded.add(component)}}else if(level<2){expanded.add(component);expandedMap.set(component,true)}else{expandedMap.set(component,false)}if(component.isFocused()){var parent=component;while(parent=parent.parent){expanded.add(parent);expandedMap.set(parent,true)}}var tmp=document.createElement("span");var b=document.createElement("b");b.appendChild(document.createTextNode(component.getFullName()));if(that.draggedComponents.includes(component)){tmp.classList.add("dragged")}if(component.isSelected()){b.classList.add("selected")}if(component.hasLabel()){b.dataset.label=component.getLabel()}cache.set(tmp,component);reverseCache.set(component,tmp);tmp.appendChild(b);tip.appendChild(tmp);var _iteratorNormalCompletion7=true;var _didIteratorError7=false
;var _iteratorError7=undefined;try{for(var _iterator7=component.framework().getComponentBadges(component)[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var badge=_step7.value;var l=document.createElement("u");l.className="material-icons "+badge.className;l.title=badge.title;l.textContent=badge.icon;tmp.appendChild(l)}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7["return"]){_iterator7["return"]()}}finally{if(_didIteratorError7){throw _iteratorError7}}}if(component.isLocked()){var l=document.createElement("u");l.className="material-icons lock";l.title="Component is Locked";l.textContent="lock_outline";tmp.appendChild(l)}if(component.linkID){var l=document.createElement("u");l.className="material-icons link";l.title="Linked Component";l.textContent="link";tmp.appendChild(l)}if(component.children&&component.children.length){var div=document.createElement("div");div.className="subtree";for(var i=0;i<component.children.length;i++){if(component.children[i]instanceof Component){walk(component.children[i],div,level+1);hasChildren=true}}tip.appendChild(div)}if(hasChildren){var i=document.createElement("i");tmp.insertBefore(i,b)}}this.scrollable.empty();this.scrollable.append(root);var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=expanded[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var comp=_step8.value;var dom=reverseCache.get(comp);if(comp instanceof ComponentWithChildren&&comp.hasChildren()){dom.children[0].classList.add("down");dom.nextSibling.style.display="block"}}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally{try{if(!_iteratorNormalCompletion8&&_iterator8["return"]){_iterator8["return"]()}}finally{if(_didIteratorError8){throw _iteratorError8}}}if(app.context.page.isSingleComponentSelected()){var _comp=app.context.page.getFirstSelectedComponent();var node=reverseCache.get(_comp);node&&node.scrollIntoViewIfNeeded();this.storeScrollPosition()}return this.element}}]);return OverviewPanel}(Panel);module.exports=OverviewPanel},{"../components/base/Component":39,"../components/base/ComponentWithChildren":40,"../helpers/canParentTakeChildren":547,"../helpers/dragScroll":558,"../helpers/isContextClick":584,"../helpers/isSelectionClick":585,"./Panel.js":1234}]
});
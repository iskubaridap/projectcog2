define([],function(){
	return [function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var WidgetDrawer=function(){function WidgetDrawer(elem){_classCallCheck(this,WidgetDrawer);this.element=elem;this.visible=false;this.opened=false;this.widgets=[];this.template=null;this.domToItem=new WeakMap;this.itemToDOM=new WeakMap;this.toggler=elem.find(".widget-toggler");this.wrapper=elem.find(".widget-wrapper");this.toggler.on("click",this.togglerClick.bind(this));this.element.on("mousedown",".item",this.mousedown.bind(this))}_createClass(WidgetDrawer,[{key:"isOpen",value:function isOpen(){return this.opened}},{key:"isVisible",value:function isVisible(){return this.visible}},{key:"togglerClick",value:function togglerClick(){if(this.isOpen()){this.close()}else{this.open()}}},{key:"mousedown",value:function mousedown(e){var toolButton=$(e.currentTarget),offset=toolButton.offset();var item=this.domToItem.get(e.target.closest("span"));if(toolButton.is("img"))e.preventDefault();if(!item.canCreate(app.context.page)){return}var elem=item.create(app.context.page);if(!elem){return}app.dragStart({components:[elem],historyTitle:"Add "+item.getName(),origin:{top:offset.top,left:offset.left,width:toolButton.outerWidth(),height:toolButton.outerHeight()},operation:item.insertOp(elem)})}},{key:"setup",value:function setup(template){this.widgets=[];this.template=null;if(!template){return}this.widgets=template.widgets;this.template=template;this.update()}},{key:"open",value:function open(){this.opened=true;this.element.addClass("open");this.element.css("transition","")}},{key:"instantClose",value:function instantClose(){this.element.hide();this.close()}},{key:"close",value:function close(){this.element.removeClass("open");this.opened=false;this.element.css("transition","")}},{key:"show",value:function show(){this.element.show();this.visible=true}},{key:"hide",value:function hide(){this.element.hide();this.visible=false;if(this.isOpen()){this.close()}}},{key:"position",value:function position(){this.element.css({transition:"none",bottom:win.height()-app.canvas.dimensions.bottom+20,right:win.width()-app.canvas.dimensions.right+20})}},{key:"update",value:function update(){var container=this.element.find(".list");var tmp=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.widgets[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var group=_step.value;tmp.push(this.renderComponentFolder(group))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}container.empty().append(tmp)}},{key:"renderComponentFolder",value:function renderComponentFolder(group){var fragment=document.createDocumentFragment();if(!group.children.length){return fragment}var tmp=document.createElement("span");tmp.className="item-folder";var b=document.createElement("b");b.className="name";b.appendChild(document.createTextNode(group.name));tmp.appendChild(b);fragment.appendChild(tmp);var groupHolder=document.createElement("div");groupHolder.className="subtree";var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=group.children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var child=_step2.value;groupHolder.appendChild(this.renderComponent(child,group))}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}fragment.appendChild(groupHolder);return fragment}},{key:"renderComponent",value:function renderComponent(comp){var group=arguments.length<=1||arguments[1]===undefined?null:arguments[1];var tmp;var framework=app.context.framework;tmp=$('<span class="item" title="'+comp.name+'">'+'<img width="100%" src="'+app.template.paths.widgetPreviews+"/"+comp.previewPath+'" draggable="false">'+"</span>");this.domToItem.set(tmp[0],comp);this.itemToDOM.set(comp,tmp[0]);return tmp[0]}}]);return WidgetDrawer}();module.exports=WidgetDrawer},{}]
});